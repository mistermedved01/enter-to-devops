[๐ ะะปะฐะฒะฝะฐั](../../README.md) โ [โ๏ธ Configuration-Management](../../README.md#-configuration-management) โ [๐ A-01-Basics](../../README.md#-a-01-basics)

---

# โ๏ธA-01-1-ะฃััะฐะฝะพะฒะบะฐ-ะธ-ะฑะฐะทะพะฒะฐั-ะฝะฐัััะพะนะบะฐ
> ะฃััะฐะฝะพะฒะบะฐ Ansible ะฝะฐ ัะฐะทะปะธัะฝัะต ะะก, ะฝะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั, ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั ะธ ะฟะตัะฒะพะต ะฟะพะดะบะปััะตะฝะธะต ะบ ัะฟัะฐะฒะปัะตะผัะผ ัะทะปะฐะผ.

---

<details>
<summary><b>๐ฏ ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะธััะตะผะต</b></summary>

---

### Control Node ััะตะฑะพะฒะฐะฝะธั

+++text
# Control Node - ัะพัั ั ัััะฐะฝะพะฒะปะตะฝะฝัะผ Ansible
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        Control Node             โ
โ   (Ansible Management Host)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โ Linux (Ubuntu, CentOS, etc.)โ
โ  โ macOS 10.10+                โ
โ  โ Windows (WSL2 recommended)  โ
โ  โ Python 3.8+                 โ
โ  โ SSH client                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
---text

### Managed Nodes ััะตะฑะพะฒะฐะฝะธั

+++text
# Managed Nodes - ัะตะปะตะฒัะต ัะตัะฒะตัั
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        Managed Nodes            โ
โ    (Target Servers)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โ Linux/Unix ัะธััะตะผะฐ          โ
โ  โ Python 2.7+ ะธะปะธ 3.5+        โ
โ  โ SSH ะดะพัััะฟ                  โ
โ  โ sudo ะฟัะฐะฒะฐ (ะดะปั ะผะฝะพะณะธั ะทะฐะดะฐั)โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะะก:
โข Red Hat Enterprise Linux 6+
โข CentOS 6+
โข Ubuntu 12.04+
โข Debian 7+
โข Fedora
โข macOS
โข BSD ะฒะฐัะธะฐะฝัั
---text

### ะกะตัะตะฒัะต ััะตะฑะพะฒะฐะฝะธั

+++text
# ะกะตัะตะฒะฐั ะบะพะฝัะธะณััะฐัะธั
Control Node ะดะพะปะถะตะฝ ะธะผะตัั ะดะพัััะฟ ะบ Managed Nodes:
โข SSH ะฟะพัั (ะพะฑััะฝะพ 22)
โข ะะพะทะผะพะถะฝะพััั ะฐััะตะฝัะธัะธะบะฐัะธะธ ะฟะพ ะบะปััะฐะผ
โข ะะฐะทัะตัะตะฝะฝัะน sudo ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั
โข ะะพัััะฟ ะบ ัะตะฟะพะทะธัะพัะธัะผ ะฟะฐะบะตัะพะฒ (ะตัะปะธ ะฝัะถะฝะพ)

# ะะตะบะพะผะตะฝะดัะตะผะฐั ะฐััะธัะตะบัััะฐ:
โโโโโโโโโโโโโโโ    SSH    โโโโโโโโโโโโโโโ
โ  Control    โ โโโโโโโโโ โ   Managed   โ
โ   Node      โ           โ    Node 1   โ
โ             โ    SSH    โโโโโโโโโโโโโโโ
โ             โ โโโโโโโโโ โโโโโโโโโโโโโโโ
โ             โ           โ   Managed   โ
โโโโโโโโโโโโโโโ           โ    Node 2   โ
                          โโโโโโโโโโโโโโโ
---text

---

</details>

<details>
<summary><b>๐ฆ ะฃััะฐะฝะพะฒะบะฐ Ansible</b></summary>

---

### ะฃััะฐะฝะพะฒะบะฐ ะฝะฐ Ubuntu/Debian

+++bash
# ะะฑะฝะพะฒะปะตะฝะธะต ัะธััะตะผั
sudo apt update && sudo apt upgrade -y

# ะฃััะฐะฝะพะฒะบะฐ Python ะธ ะทะฐะฒะธัะธะผะพััะตะน
sudo apt install -y python3 python3-pip sshpass

# ะฃััะฐะฝะพะฒะบะฐ Ansible ัะตัะตะท apt
sudo apt install -y ansible

# ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ
ansible --version

# ะะปััะตัะฝะฐัะธะฒะฐ: ัััะฐะฝะพะฒะบะฐ ัะตัะตะท pip
sudo pip3 install ansible
---bash

### ะฃััะฐะฝะพะฒะบะฐ ะฝะฐ CentOS/RHEL

+++bash
# ะฃััะฐะฝะพะฒะบะฐ EPEL ัะตะฟะพะทะธัะพัะธั (CentOS/RHEL 7/8)
sudo yum install -y epel-release

# ะฃััะฐะฝะพะฒะบะฐ Ansible
sudo yum install -y ansible

# ะะปั CentOS/RHEL 8+
sudo dnf install -y ansible

# ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ
ansible --version
---bash

### ะฃััะฐะฝะพะฒะบะฐ ะฝะฐ macOS

+++bash
# ะฃััะฐะฝะพะฒะบะฐ ัะตัะตะท Homebrew
brew install ansible

# ะะปะธ ัะตัะตะท pip
pip3 install ansible

# ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ
ansible --version
---bash

### ะฃััะฐะฝะพะฒะบะฐ ะฝะฐ Windows

+++bash
# ะงะตัะตะท WSL2 (ัะตะบะพะผะตะฝะดัะตััั)
# 1. ะฃััะฐะฝะพะฒะธัั WSL2 ั Ubuntu
# 2. ะ WSL ะฒัะฟะพะปะฝะธัั:
sudo apt update && sudo apt install -y ansible

# ะงะตัะตะท Chocolatey (ะผะตะฝะตะต ะฟัะตะดะฟะพััะธัะตะปัะฝะพ)
choco install ansible
---bash

### ะฃััะฐะฝะพะฒะบะฐ ัะตัะตะท pip (ัะฝะธะฒะตััะฐะปัะฝัะน ัะฟะพัะพะฑ)

+++bash
# ะฃััะฐะฝะพะฒะบะฐ pip ะตัะปะธ ะฝะตั
sudo apt install -y python3-pip  # Ubuntu/Debian
sudo yum install -y python3-pip  # CentOS/RHEL

# ะฃััะฐะฝะพะฒะบะฐ Ansible
sudo pip3 install ansible

# ะัะพะฒะตัะบะฐ
ansible --version
---bash

---

</details>

<details>
<summary><b>๐ง ะะฐะทะพะฒะฐั ะฝะฐัััะพะนะบะฐ</b></summary>

---

### ะกัััะบัััะฐ ะบะฐัะฐะปะพะณะพะฒ Ansible

+++text
# ะะตะบะพะผะตะฝะดัะตะผะฐั ััััะบัััะฐ ะฟัะพะตะบัะฐ
ansible-project/
โโโ ansible.cfg          # ะะพะฝัะธะณััะฐัะธั Ansible
โโโ inventory            # ะคะฐะนะป ะธะฝะฒะตะฝัะฐัั
โ   โโโ hosts           # ะัะฝะพะฒะฝะพะน ะธะฝะฒะตะฝัะฐัั
โ   โโโ group_vars/     # ะะตัะตะผะตะฝะฝัะต ะณััะฟะฟ
โ       โโโ all.yml     # ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
โโโ playbooks/          # Playbook ัะฐะนะปั
โ   โโโ site.yml        # ะัะฝะพะฒะฝะพะน playbook
โโโ roles/              # ะะพะปะธ Ansible
โโโ files/              # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั
---text

### ะกะพะทะดะฐะฝะธะต ะฑะฐะทะพะฒะพะน ะบะพะฝัะธะณััะฐัะธะธ

+++bash
# ะกะพะทะดะฐะฝะธะต ัะฐะฑะพัะตะณะพ ะบะฐัะฐะปะพะณะฐ
mkdir ~/ansible-project
cd ~/ansible-project

# ะกะพะทะดะฐะฝะธะต ansible.cfg
cat > ansible.cfg << EOF
[defaults]
inventory = ./inventory/hosts
host_key_checking = False
remote_user = ubuntu
private_key_file = ~/.ssh/id_rsa

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False
EOF
---bash

### ะะฐัััะพะนะบะฐ SSH ะดะพัััะฟะฐ

+++bash
# ะะตะฝะตัะฐัะธั SSH ะบะปััะฐ ะตัะปะธ ะฝะตั
ssh-keygen -t rsa -b 4096 -C "ansible-control-node"

# ะะพะฟะธัะพะฒะฐะฝะธะต ะบะปััะฐ ะฝะฐ ัะฟัะฐะฒะปัะตะผัะต ัะทะปั
ssh-copy-id ubuntu@managed-node-ip

# ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพะดะบะปััะตะฝะธั
ssh ubuntu@managed-node-ip
---bash

---

</details>

<details>
<summary><b>๐ ะกะพะทะดะฐะฝะธะต ะธะฝะฒะตะฝัะฐัั</b></summary>

---

### ะะฐะทะพะฒัะน inventory ัะฐะนะป

+++text
# inventory/hosts
[web_servers]
web1.example.com
web2.example.com ansible_host=192.168.1.11
web3.example.com ansible_host=192.168.1.12 ansible_user=deploy

[db_servers]
db1.example.com ansible_host=192.168.1.21
db2.example.com ansible_host=192.168.1.22

[production:children]
web_servers
db_servers

[production:vars]
ansible_ssh_private_key_file=~/.ssh/production_key
timezone=Europe/Moscow
---text

### ะะตัะตะผะตะฝะฝัะต ะฒ ะธะฝะฒะตะฝัะฐัะต

+++text
# ะะฟัะตะดะตะปะตะฝะธะต ะฟะตัะตะผะตะฝะฝัั ะฝะฐ ัะฐะทะฝัั ััะพะฒะฝัั:

1. ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต (group_vars/all.yml):
   package_manager: apt
   system_user: deploy

2. ะะตัะตะผะตะฝะฝัะต ะณััะฟะฟ (group_vars/web_servers.yml):
   web_package: nginx
   web_port: 80

3. ะะตัะตะผะตะฝะฝัะต ัะพััะพะฒ (ะฒ inventory):
   host1 ansible_host=192.168.1.10 http_port=8080

4. Host variables (host_vars/host1.yml):
   database_host: localhost
   cache_enabled: true
---text

### ะกะพะทะดะฐะฝะธะต ััััะบัััั ะบะฐัะฐะปะพะณะพะฒ

+++bash
# ะกะพะทะดะฐะฝะธะต ะฟะพะปะฝะพะน ััััะบัััั
mkdir -p ~/ansible-project/{inventory,playbooks,roles,files,group_vars,host_vars}

# ะกะพะทะดะฐะฝะธะต ะพัะฝะพะฒะฝัั ัะฐะนะปะพะฒ
touch ~/ansible-project/inventory/hosts
touch ~/ansible-project/playbooks/site.yml

# ะกะพะทะดะฐะฝะธะต group_vars
mkdir -p ~/ansible-project/group_vars
cat > ~/ansible-project/group_vars/all.yml << EOF
---
ansible_ssh_private_key_file: "~/.ssh/id_rsa"
ansible_user: "ubuntu"
timezone: "Europe/Moscow"
EOF
---bash

---

</details>

<details>
<summary><b>๐ ะะตัะฒะพะต ะฟะพะดะบะปััะตะฝะธะต</b></summary>

---

### ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพะดะบะปััะตะฝะธั

+++bash
# ะัะพะฒะตัะบะฐ ัะธะฝัะฐะบัะธัะฐ inventory
ansible-inventory -i inventory/hosts --list

# Ping ะฒัะตั ัะพััะพะฒ ะฒ inventory
ansible all -i inventory/hosts -m ping

# Ping ะบะพะฝะบัะตัะฝะพะน ะณััะฟะฟั
ansible web_servers -i inventory/hosts -m ping

# ะัะพะฒะตัะบะฐ ั ะฒัะฒะพะดะพะผ ัะฐะบัะพะฒ
ansible all -i inventory/hosts -m setup | less
---bash

### Ad-Hoc ะบะพะผะฐะฝะดั ะดะปั ะฟัะพะฒะตัะบะธ

+++bash
# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ
ansible all -i inventory/hosts -m ping

# ะัะพะฒะตัะบะฐ ัะฒะพะฑะพะดะฝะพะน ะฟะฐะผััะธ
ansible all -i inventory/hosts -a "free -h"

# ะัะพะฒะตัะบะฐ ะดะธัะบะพะฒะพะณะพ ะฟัะพัััะฐะฝััะฒะฐ
ansible all -i inventory/hosts -a "df -h"

# ะัะพะฒะตัะบะฐ ะฒะตััะธะธ ะะก
ansible all -i inventory/hosts -a "cat /etc/os-release"
---bash

### ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ ั ะฟะพะดะบะปััะตะฝะธะตะผ

+++bash
# ะัะพะฒะตัะบะฐ SSH ะฟะพะดะบะปััะตะฝะธั
ssh -i ~/.ssh/id_rsa ubuntu@web1.example.com

# ะัะพะฒะตัะบะฐ ั verbose ะฒัะฒะพะดะพะผ
ansible all -i inventory/hosts -m ping -vvv

# ะัะพะฒะตัะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ัะพััะฐ
ansible web1.example.com -i inventory/hosts -m ping -vvv

# ะัะพะฒะตัะบะฐ Python ะฝะฐ managed node
ansible all -i inventory/hosts -a "python3 --version"
---bash

---

</details>

<details>
<summary><b>โ๏ธ ะะพะฝัะธะณััะฐัะธั ansible.cfg</b></summary>

---

### ะัะฝะพะฒะฝัะต ะฝะฐัััะพะนะบะธ

+++text
# ansible.cfg - ะพัะฝะพะฒะฝัะต ัะตะบัะธะธ
[defaults]
inventory      = ./inventory/hosts    # ะััั ะบ ะธะฝะฒะตะฝัะฐัั
host_key_checking = False            # ะัะบะปััะตะฝะธะต ะฟัะพะฒะตัะบะธ host key
remote_user    = ubuntu              # ะะพะปัะทะพะฒะฐัะตะปั ะฟะพ ัะผะพะปัะฐะฝะธั
private_key_file = ~/.ssh/id_rsa     # SSH ะบะปัั ะฟะพ ัะผะพะปัะฐะฝะธั
roles_path    = ./roles              # ะััั ะบ ัะพะปัะผ

[privilege_escalation]
become          = True               # ะะบะปััะตะฝะธะต sudo
become_method   = sudo               # ะะตัะพะด ะฟะพะฒััะตะฝะธั ะฟัะฐะฒ
become_user     = root               # ะะพะปัะทะพะฒะฐัะตะปั ะดะปั become
become_ask_pass = False              # ะะต ะทะฐะฟัะฐัะธะฒะฐัั ะฟะฐัะพะปั

[ssh_connection]
ssh_args        = -o ControlMaster=auto -o ControlPersist=60s
pipelining      = True               # ะฃัะบะพัะตะฝะธะต ะฒัะฟะพะปะฝะตะฝะธั
---text

### ะะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

+++text
# ะะฐัััะพะนะบะธ ะดะปั ััะบะพัะตะฝะธั ัะฐะฑะพัั
[defaults]
forks = 10                           # ะะพะปะธัะตััะฒะพ ะฟะฐัะฐะปะปะตะปัะฝัั ะฟัะพัะตััะพะฒ
gathering = smart                    # ะฃะผะฝัะน ัะฑะพั ัะฐะบัะพะฒ
fact_caching = memory                # ะััะธัะพะฒะฐะฝะธะต ัะฐะบัะพะฒ
stdout_callback = yaml               # ะคะพัะผะฐั ะฒัะฒะพะดะฐ
bin_ansible_callbacks = True         # Callbacks ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

[ssh_connection]
control_path = %(directory)s/%%h-%%r  # SSH control path
pipelining = True                    # pipelining ะดะปั ััะบะพัะตะฝะธั
---text

### ะัะธะพัะธัะตั ะบะพะฝัะธะณััะฐัะธะพะฝะฝัั ัะฐะนะปะพะฒ

+++text
# Ansible ะธัะตั ะบะพะฝัะธะณ ะฒ ัะปะตะดัััะตะผ ะฟะพััะดะบะต:
1. ANSIBLE_CONFIG (ะฟะตัะตะผะตะฝะฝะฐั ะพะบััะถะตะฝะธั)
2. ./ansible.cfg (ัะตะบััะฐั ะดะธัะตะบัะพัะธั)
3. ~/.ansible.cfg (ะดะพะผะฐัะฝัั ะดะธัะตะบัะพัะธั)
4. /etc/ansible/ansible.cfg (ะณะปะพะฑะฐะปัะฝะฐั ะบะพะฝัะธะณััะฐัะธั)

# ะะตะบะพะผะตะฝะดัะตััั:
โข ะัะฟะพะปัะทะพะฒะฐัั ./ansible.cfg ะดะปั ะฟัะพะตะบัะพะฒ
โข ะฅัะฐะฝะธัั ะบะพะฝัะธะณ ะฒ ัะธััะตะผะต ะบะพะฝััะพะปั ะฒะตััะธะน
โข ะะต ะธัะฟะพะปัะทะพะฒะฐัั ะณะปะพะฑะฐะปัะฝัะน /etc/ansible/ansible.cfg
---text

---

</details>

<details>
<summary><b>๐ ะัะพะฒะตัะบะฐ ัััะฐะฝะพะฒะบะธ</b></summary>

---

### ะะพะผprehensive ะฟัะพะฒะตัะบะฐ

+++bash
# ะัะพะฒะตัะบะฐ ะฒะตััะธะธ Ansible
ansible --version

# ะัะพะฒะตัะบะฐ ะธะฝะฒะตะฝัะฐัั
ansible-inventory --list

# ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบะพ ะฒัะตะผ ัะพััะฐะผ
ansible all -m ping

# ะัะพะฒะตัะบะฐ ัะฐะบัะพะฒ
ansible all -m setup -a "filter=ansible_distribution*"

# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝัั ะผะพะดัะปะตะน
ansible-doc -l | head -20
---bash

### ะกะพะทะดะฐะฝะธะต ัะตััะพะฒะพะณะพ playbook

+++yaml
# playbooks/test.yml
---
- name: Test Ansible Installation
  hosts: all
  become: yes
  
  tasks:
    - name: Display OS information
      debug:
        msg: "This is {{ ansible_distribution }} {{ ansible_distribution_version }}"
    
    - name: Check disk space
      command: df -h
      register: disk_result
    
    - name: Display disk space
      debug:
        var: disk_result.stdout
---yaml

+++bash
# ะะฐะฟััะบ ัะตััะพะฒะพะณะพ playbook
ansible-playbook playbooks/test.yml

# ะะฐะฟััะบ ั ะฟัะพะฒะตัะบะพะน ัะธะฝัะฐะบัะธัะฐ
ansible-playbook --syntax-check playbooks/test.yml

# ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ะฟัะพะฒะตัะบะธ (dry-run)
ansible-playbook --check playbooks/test.yml
---bash

---

</details>

<details>
<summary><b>๐ฏ ะะปััะตะฒัะต ะฒัะฒะพะดั</b></summary>

---

### ะงัะพ ะผั ัะดะตะปะฐะปะธ

+++text
โ ะฃััะฐะฝะพะฒะธะปะธ Ansible ะฝะฐ Control Node
โ ะะฐัััะพะธะปะธ SSH ะดะพัััะฟ ะบ Managed Nodes
โ ะกะพะทะดะฐะปะธ ััััะบัััั ะฟัะพะตะบัะฐ Ansible
โ ะะฐัััะพะธะปะธ inventory ะธ ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั
โ ะัะพัะตััะธัะพะฒะฐะปะธ ะฟะพะดะบะปััะตะฝะธะต ะบ ัะฟัะฐะฒะปัะตะผัะผ ัะทะปะฐะผ
โ ะะฐะฟัััะธะปะธ ะฟะตัะฒัะน playbook
---text

### Best Practices ัััะฐะฝะพะฒะบะธ

+++text
๐ง ะัะฟะพะปัะทัะนัะต ะพัะดะตะปัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะดะปั Ansible
๐ ะะฐัััะพะนัะต SSH ะดะพัััะฟ ะฟะพ ะบะปััะฐะผ
๐ ะกะพะทะดะฐะฒะฐะนัะต ััััะบัััะธัะพะฒะฐะฝะฝัะต ะฟัะพะตะบัั
โ๏ธ ะะฐัััะฐะธะฒะฐะนัะต ansible.cfg ะดะปั ะบะฐะถะดะพะณะพ ะฟัะพะตะบัะฐ
๐ ะัะตะณะดะฐ ะฟัะพะฒะตััะนัะต ะฟะพะดะบะปััะตะฝะธะต ะฟะตัะตะด ัะฐะฑะพัะพะน
๐ ะะพะบัะผะตะฝัะธััะนัะต ััััะบัััั ะธะฝะฒะตะฝัะฐัั
---text

### ะงัะพ ะธะทััะฐะตะผ ะดะฐะปััะต

+++text
๐ ะกะปะตะดัััะฐั ัะตะผะฐ: Ansible ะฐััะธัะตะบัััะฐ ะธ ะธะฝะฒะตะฝัะฐัั
๐ฏ ะฃะณะปัะฑะปะตะฝะธะต: ะััะฟะฟั, ะฟะตัะตะผะตะฝะฝัะต, ะดะธะฝะฐะผะธัะตัะบะธะน ะธะฝะฒะตะฝัะฐัั
๐ง ะัะฐะบัะธะบะฐ: ะกะพะทะดะฐะฝะธะต ัะปะพะถะฝัั inventory ััััะบััั
---text

---

</details>
