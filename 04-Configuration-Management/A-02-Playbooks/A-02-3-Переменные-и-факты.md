[üè† –ì–ª–∞–≤–Ω–∞—è](../../README.md) ‚Üí [‚öôÔ∏è Configuration-Management](../../README.md#-configuration-management) ‚Üí [üìù A-02-Playbooks](../../README.md#-a-02-playbooks)

---

# ‚öôÔ∏èA-02-3-–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–∏-—Ñ–∞–∫—Ç—ã
> –†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤ Ansible: —Ç–∏–ø—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, —Ñ–∞–∫—Ç—ã –æ —Å–∏—Å—Ç–µ–º–µ, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —à–∞–±–ª–æ–Ω—ã Jinja2.

---

<details>
<summary><b>üéØ –¢–∏–ø—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ Ansible</b></summary>

---

### –ò–µ—Ä–∞—Ä—Ö–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

+++text
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É):
1. Extra variables (-e –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ)
2. Task variables (–≤ –∑–∞–¥–∞—á–∞—Ö, –≤–∫–ª—é—á–∞—è include_vars)
3. Block variables (–≤ –±–ª–æ–∫–∞—Ö)
4. Role and include variables
5. Play variables (vars: –≤ playbook)
6. Host variables (host_vars/)
7. Group variables (group_vars/)
8. Inventory variables
9. Facts (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ–º—ã–µ)
10. Role defaults
---text

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

+++yaml
# –í playbook
---
- name: Configure web server
  hosts: web_servers
  vars:
    web_package: nginx
    web_port: 80
    web_user: www-data
  
  tasks:
    - name: Install web server
      package:
        name: "{{ web_package }}"
        state: present
---yaml

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–∞—Ö

+++yaml
# group_vars/all.yml
---
# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
ansible_user: ubuntu
timezone: Europe/Moscow
package_manager: apt

# group_vars/web_servers.yml
---
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä—É–ø–ø—ã web_servers
web_package: nginx
web_port: 80
web_document_root: /var/www/html
---yaml

---

</details>

<details>
<summary><b>üìä –§–∞–∫—Ç—ã —Å–∏—Å—Ç–µ–º—ã</b></summary>

---

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç—ã

+++bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ–≤
ansible all -m setup

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ–≤
ansible all -m setup -a "filter=ansible_distribution*"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã
ansible all -m setup -a "filter=ansible_memory*"
---bash

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤ –≤ playbook

+++yaml
---
- name: Display system information
  hosts: all
  tasks:
    - name: Show OS information
      debug:
        msg: "OS: {{ ansible_distribution }} {{ ansible_distribution_version }}"
    
    - name: Show memory information
      debug:
        msg: "Total memory: {{ ansible_memtotal_mb }}MB"
    
    - name: Show network interfaces
      debug:
        msg: "Interfaces: {{ ansible_interfaces }}"
---yaml

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–±–æ—Ä–∞ —Ñ–∞–∫—Ç–æ–≤

+++yaml
---
- name: Quick task without facts
  hosts: all
  gather_facts: no
  tasks:
    - name: Simple task
      command: echo "Hello"
---yaml

---

</details>

<details>
<summary><b>üîß –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</b></summary>

---

### –ú–æ–¥—É–ª—å register

+++yaml
---
- name: Check disk space
  hosts: all
  tasks:
    - name: Get disk usage
      command: df -h
      register: disk_usage
    
    - name: Display disk usage
      debug:
        var: disk_usage.stdout_lines
    
    - name: Check if disk is full
      fail:
        msg: "Disk is full!"
      when: "'100%' in disk_usage.stdout"
---yaml

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

+++yaml
---
- name: Service management
  hosts: all
  tasks:
    - name: Check service status
      service:
        name: nginx
      register: nginx_status
    
    - name: Restart if not running
      service:
        name: nginx
        state: restarted
      when: not nginx_status.status.ActiveState == "active"
---yaml

---

</details>

<details>
<summary><b>üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</b></summary>

---

### Best Practices –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

+++text
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚úÖ –û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–∫—Ç—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚úÖ –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ register –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
---text

### –ß—Ç–æ –∏–∑—É—á–∞–µ–º –¥–∞–ª—å—à–µ

+++text
üìö –°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞: –£—Å–ª–æ–≤–∏—è –∏ —Ü–∏–∫–ª—ã
üéØ –ü—Ä–∞–∫—Ç–∏–∫–∞: –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ playbook
üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –¶–∏–∫–ª—ã –∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏
---text

---

</details>
