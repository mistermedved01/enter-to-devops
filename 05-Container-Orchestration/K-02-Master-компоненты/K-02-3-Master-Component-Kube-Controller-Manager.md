[üè† –ì–ª–∞–≤–Ω–∞—è](../../README.md) ‚Üí [‚ò∏Ô∏è Container-Orchestration](../../README.md#-container-orchestration) ‚Üí [üéõÔ∏è K-02-Master-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](../../README.md#-k-02-master-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)

---

# üéõÔ∏èK-02-3-Master-Component-Kube-Controller-Manager
>kube-controller-manager - –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤, —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

<details>
<summary><b>üéØ–ß—Ç–æ —Ç–∞–∫–æ–µ Controller Manager?</b></summary>

---

## –ê–Ω–∞–ª–æ–≥–∏—è —Å –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–µ–π

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ **kube-controller-manager** –∫–∞–∫ —Ñ–ª–æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π:

- **üõ∏ –°–∫–∞–Ω–∏—Ä—É—é—â–∏–µ –∫–æ—Ä–∞–±–ª–∏** - –º–æ–Ω–∏—Ç–æ—Ä—è—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä—É–∑–æ–≤—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π
- **üõ∏ –ê–≤–∞—Ä–∏–π–Ω—ã–µ –±—Ä–∏–≥–∞–¥—ã** - —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è
- **üõ∏ –ë—É–∫—Å–∏—Ä—ã-–ø–æ–º–æ—â–Ω–∏–∫–∏** - –ø–æ–º–æ–≥–∞—é—Ç —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- **üõ∏ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –Ω–∞–≥—Ä—É–∑–∫–∏** - —Å–ª–µ–¥—è—Ç –∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∫–æ—Ä–∞–±–ª—è–º–∏

## –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –≤ Kubernetes

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç** —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ **–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç** —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –∂–µ–ª–∞–µ–º—ã–º
- ‚úÖ **–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è** –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –≤ –Ω—É–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑** kube-apiserver

---

</details>

<details>
<summary><b>üîß–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã</b></summary>

---

## Node Controller

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö —É–∑–ª–æ–≤:

```
# –¢–∞–π–º–∏–Ω–≥–∏ Node Controller
--node-monitor-period=5s       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
--node-monitor-grace-period=40s # –û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–º–µ—Ç–∫–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
--pod-eviction-timeout=5m0s    # –û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —ç–≤–∞–∫—É–∞—Ü–∏–µ–π Pod'–æ–≤
```

**–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:**
1. ‚ùå –ù–æ–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å heartbeat
2. ‚è±Ô∏è –ß–µ—Ä–µ–∑ 40 —Å–µ–∫—É–Ω–¥ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è
3. ‚è±Ô∏è –î–∞–µ—Ç—Å—è 5 –º–∏–Ω—É—Ç –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
4. üö® –£–¥–∞–ª—è—é—Ç—Å—è Pods –∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –Ω–æ–¥—ã

## Replication Controller

–°–ª–µ–¥–∏—Ç –∑–∞ ReplicaSets –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Pods:

```
# –ï—Å–ª–∏ Pod —É–º–∏—Ä–∞–µ—Ç, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π
apiVersion: apps/v1
kind: ReplicaSet
spec:
  replicas: 3  # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±–µ—Å–ø–µ—á–∏—Ç 3 —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö Pod'–∞
```

## –î—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

| –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|------------|----------------|
| **Deployment** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π |
| **Service** | –°–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ |
| **Namespace** | –ò–∑–æ–ª—è—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ |
| **PersistentVolume** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º |
| **Job/CronJob** | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á |

---

</details>

<details>
<summary><b>üõ†Ô∏è–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</b></summary>

---

## –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```
# –°–∫–∞—á–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫ kube-controller-manager
wget https://github.com/kubernetes/kubernetes/releases/download/v1.28.0/kubernetes-server-linux-amd64.tar.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
tar -xzf kubernetes-server-linux-amd64.tar.gz
cd kubernetes/server/bin
cp kube-controller-manager /usr/local/bin/
```

## –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

```
kube-controller-manager \
  --kubeconfig=/etc/kubernetes/controller-manager.conf \
  --bind-address=0.0.0.0 \
  --cluster-cidr=10.244.0.0/16 \
  --service-cluster-ip-range=10.96.0.0/12 \
  --node-monitor-period=5s \
  --node-monitor-grace-period=40s \
  --pod-eviction-timeout=5m0s \
  --controllers=*,bootstrapsigner,tokencleaner
```

## –í–∞–∂–Ω—ã–µ –æ–ø—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `--controllers` | –°–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–∞–µ–º—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ |
| `--node-monitor-period` | –ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–¥ |
| `--node-monitor-grace-period` | –û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–º–µ—Ç–∫–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ |
| `--pod-eviction-timeout` | –¢–∞–π–º–∞—É—Ç —ç–≤–∞–∫—É–∞—Ü–∏–∏ Pod'–æ–≤ |
| `--cluster-cidr` | CIDR –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| `--service-cluster-ip-range` | –î–∏–∞–ø–∞–∑–æ–Ω IP –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ |

---

</details>

<details>
<summary><b>üîç–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b></summary>

---

## –î–ª—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ kubeadm

```
# kube-controller-manager —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ Pod
kubectl get pods -n kube-system | grep controller-manager

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç Pod
cat /etc/kubernetes/manifests/kube-controller-manager.yaml

# –ò–ª–∏ —á–µ—Ä–µ–∑ kubectl
kubectl get pod kube-controller-manager-node1 -n kube-system -o yaml
```

## –î–ª—è —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å systemd service
cat /etc/systemd/system/kube-controller-manager.service

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep kube-controller-manager

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É
ps -ef | grep kube-controller-manager | grep -v grep
```

## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
# kubeadm –∫–ª–∞—Å—Ç–µ—Ä
/etc/kubernetes/manifests/kube-controller-manager.yaml
/etc/kubernetes/controller-manager.conf

# –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞  
/etc/systemd/system/kube-controller-manager.service
/etc/kubernetes/controller-manager.conf
```

---

</details>

<details>
<summary><b>‚öôÔ∏è–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏</b></summary>

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä --controllers

```
# –í–∫–ª—é—á–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
--controllers=*

# –í–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
--controllers=deployment,replicaset,namespace

# –ò—Å–∫–ª—é—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
--controllers=*-node,-bootstrapsigner
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

```
# –û–±—â–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
deployment, replicaset, namespace, serviceaccount

# –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –Ω–æ–¥
node, route, service, cloud-node-lifecycle

# –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∑–∞–¥–∞–Ω–∏–π
job, cronjob

# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
bootstrapsigner, tokencleaner
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Kubernetes –±—É–¥–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∞.

---

</details>

<details>
<summary><b>üîß–¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥</b></summary>

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

```
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
kubectl get pods -n kube-system -l component=kube-controller-manager

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
kubectl logs -n kube-system kube-controller-manager-node1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
kubectl get events --sort-by='.lastTimestamp'
```

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
kubectl describe pod kube-controller-manager-node1 -n kube-system

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
ls -la /etc/kubernetes/pki/
```

### –ù–æ–¥—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å
```
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
ps aux | grep kube-controller-manager | grep -o "node-monitor.*"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å —Å API —Å–µ—Ä–≤–µ—Ä–æ–º
kubectl get nodes -w
```

---

</details>

---

## –†–µ–∑—é–º–µ

‚úÖ **kube-controller-manager** ‚Äî –º–æ–∑–≥ Kubernetes, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

‚úÖ **–†–æ–ª—å Controller Manager:**
- –ú–æ–∑–≥ Kubernetes ‚Äî —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Äî –ø—Ä–∏–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –∫ –∂–µ–ª–∞–µ–º–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Äî —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö
- –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
```
–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí –ñ–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
       ‚Üì                  ‚Üì              ‚Üì
   kube-apiserver   –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏     kube-apiserver
        ‚Üì           –∫–æ—Ä—Ä–µ–∫—Ü–∏—è           ‚Üì
      ETCD                          –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤
                                   –∫–ª–∞—Å—Ç–µ—Ä–µ
```

> üöÄ **–î–∞–ª—å—à–µ:** –†–∞—Å—Å–º–æ—Ç—Ä–∏–º kube-scheduler - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Pod'–æ–≤ –ø–æ –Ω–æ–¥–∞–º.

---

---