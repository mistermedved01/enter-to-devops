[üè† –ì–ª–∞–≤–Ω–∞—è](../../README.md) ‚Üí [‚ò∏Ô∏è Container-Orchestration](../../README.md#-container-orchestration) ‚Üí [‚öôÔ∏è K-03-Worker-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](../../README.md#-k-03-worker-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)

---

# ‚öôÔ∏èK-03-2-Worker-Component-Kube-Proxy
>kube-proxy - —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∫—Å–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏

---

<details>
<summary><b>üéØ–†–æ–ª—å kube-proxy –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ</b></summary>

---

## –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ç–µ–≤–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

**–ë–µ–∑ kube-proxy:**
- ‚úÖ Pod'—ã –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ POD network
- ‚ùå IP-–∞–¥—Ä–µ—Å–∞ Pod'–æ–≤ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã
- ‚ùå –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥—Ä—É–ø–ø–∞–º Pod'–æ–≤

**–° kube-proxy:**
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ Service IP-–∞–¥—Ä–µ—Å–∞
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É Pod'–∞–º–∏
- ‚úÖ DNS-–∏–º–µ–Ω–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

## –ê–Ω–∞–ª–æ–≥–∏—è —Å —Å–µ—Ç–µ–≤—ã–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º

```
# kube-proxy = —Å–µ—Ç–µ–≤–æ–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä —Å—Ç–∞–Ω—Ü–∏–∏
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–ª—É–∂–±—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

Service (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π) ‚Üí kube-proxy ‚Üí –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ Pod'—ã
      ‚Üì                     ‚Üì              ‚Üì
   db-service          –ü—Ä–∞–≤–∏–ª–∞         [pod-db-1]
   IP: 10.96.0.12     –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏    [pod-db-2]
```

---

</details>

<details>
<summary><b>üåê–°–µ—Ç–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Kubernetes</b></summary>

---

## POD Network

```
# –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å–µ—Ç—å, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∞—è –≤—Å–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
Node1: [Pod A: 10.244.1.2] ‚Üî [Pod B: 10.244.2.3] :Node2
     ‚Üì          POD Network           ‚Üì
  eth0: 192.168.1.10             eth0: 192.168.1.11
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ POD Network:**
- üîπ –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è overlay-—Å–µ—Ç—å
- üîπ –í—Å–µ Pod'—ã –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º
- üîπ –†–∞–∑–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Flannel, Calico, WeaveNet)

## Services - –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

```
# Service –ù–ï —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏–ª–∏ Pod'–æ–º
# –≠—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –≤ –ø–∞–º—è—Ç–∏ –Ω–æ–¥

apiVersion: v1
kind: Service
metadata:
  name: db-service
spec:
  selector:
    app: database
  ports:
    - protocol: TCP
      port: 5432
      targetPort: 5432
```

**–í–∞–∂–Ω–æ:** Service –Ω–µ –∏–º–µ–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è!

---

</details>

<details>
<summary><b>üîß–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç kube-proxy</b></summary>

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤

```
# kube-proxy –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
kube-proxy ‚Üí kube-apiserver ‚Üí –°–æ–±—ã—Ç–∏—è –æ —Å–µ—Ä–≤–∏—Å–∞—Ö
     ‚Üì              ‚Üì               ‚Üì
 –û–±–Ω–æ–≤–ª—è–µ—Ç     –ü–æ–ª—É—á–∞–µ—Ç       Service created
 –ø—Ä–∞–≤–∏–ª–∞     –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é      Service deleted
```

## –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª IPTABLES

```
# –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞
# –¢—Ä–∞—Ñ–∏–∫ –Ω–∞ Service IP –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ Pod IP

Service: 10.106.0.12:5432 ‚Üí iptables ‚Üí Pod: 10.244.0.3:5432
                          ‚Üí Pod: 10.244.0.4:5432
                          ‚Üí Pod: 10.244.0.5:5432
```

## –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—Ä–æ—Å–∞

```
# –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –æ—Ç–≤–µ—Ç–∞
Web Pod ‚Üí db-service:5432 ‚Üí iptables ‚Üí Database Pod
   ‚Üì           ‚Üì               ‚Üì           ‚Üì
10.244.1.5  10.106.0.12    –ü—Ä–∞–≤–∏–ª–∞    10.244.0.3
                          –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
```

---

</details>

<details>
<summary><b>üõ†Ô∏è–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã kube-proxy</b></summary>

---

## userspace (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π)

```
# kube-proxy —Å–∞–º –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫
kube-proxy --proxy-mode=userspace
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üîπ –ú–µ–¥–ª–µ–Ω–Ω—ã–π (—Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ userspace)
- üîπ –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ä–µ–∂–∏–º
- üîπ –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

## iptables (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç iptables –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
kube-proxy --proxy-mode=iptables
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üîπ –ë—ã—Å—Ç—Ä—ã–π (—Ç—Ä–∞—Ñ–∏–∫ –≤ kernel space)
- üîπ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º
- üîπ –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## ipvs (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

```
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç IP Virtual Server
kube-proxy --proxy-mode=ipvs
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üîπ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
- üîπ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

---

</details>

<details>
<summary><b>‚öôÔ∏è–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</b></summary>

---

## –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```
# –°–∫–∞—á–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫ kube-proxy
wget https://github.com/kubernetes/kubernetes/releases/download/v1.28.0/kubernetes-server-linux-amd64.tar.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
tar -xzf kubernetes-server-linux-amd64.tar.gz
cd kubernetes/server/bin
cp kube-proxy /usr/local/bin/
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è kube-proxy

```
kube-proxy \
  --kubeconfig=/etc/kubernetes/kube-proxy.conf \
  --cluster-cidr=10.244.0.0/16 \
  --proxy-mode=iptables \
  --conntrack-max-per-core=0
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `--kubeconfig` | –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API |
| `--cluster-cidr` | CIDR Pod network |
| `--proxy-mode` | –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (iptables/ipvs) |
| `--conntrack-max-per-core` | –õ–∏–º–∏—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |

---

</details>

<details>
<summary><b>üîçkube-proxy –≤ kubeadm –∫–ª–∞—Å—Ç–µ—Ä–µ</b></summary>

---

## DaemonSet —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```
# kubeadm —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç kube-proxy –∫–∞–∫ DaemonSet
kubectl get daemonset -n kube-system kube-proxy

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å Pod'—ã kube-proxy –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö
kubectl get pods -n kube-system -l k8s-app=kube-proxy
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ñ–∏–≥ kube-proxy
kubectl get configmap -n kube-system kube-proxy -o yaml

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ kube-proxy
kubectl logs -n kube-system -l k8s-app=kube-proxy
```

## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ kubeadm

```
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
/etc/kubernetes/kube-proxy.conf
/var/lib/kube-proxy/config.conf

# DaemonSet –º–∞–Ω–∏—Ñ–µ—Å—Ç
kubectl get daemonset kube-proxy -n kube-system -o yaml
```

---

</details>

<details>
<summary><b>üéØ–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã</b></summary>

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **üìå –°–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∫—Å–∏** - –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É Service abstraction
2. **üìå –ù–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ DaemonSet
3. **üìå –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç iptables/ipvs
4. **üìå –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É Pod'–∞–º–∏
5. **üìå –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
Service ‚Üí kube-proxy ‚Üí –°–µ—Ç–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí Pod'—ã –±—ç–∫–µ–Ω–¥–∞
   ‚Üì           ‚Üì              ‚Üì              ‚Üì
–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π  –°–æ–∑–¥–∞–µ—Ç      iptables/ipvs   –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ
IP: 10.96.x.x –ø—Ä–∞–≤–∏–ª–∞     –ø—Ä–∞–≤–∏–ª–∞         –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```

---

</details>

---