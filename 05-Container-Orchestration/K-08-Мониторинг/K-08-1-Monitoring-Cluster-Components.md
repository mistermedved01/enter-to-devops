[๐ ะะปะฐะฒะฝะฐั](../../README.md) โ [โธ๏ธ Container-Orchestration](../../README.md#-container-orchestration) โ [๐ K-08-ะะพะฝะธัะพัะธะฝะณ](../../README.md#-k-08-ะผะพะฝะธัะพัะธะฝะณ)

---

# ๐K-08-1-Monitoring-Cluster-Components
>ะะพะฝะธัะพัะธะฝะณ ะบะปะฐััะตัะฐ Kubernetes: ะพััะปะตะถะธะฒะฐะฝะธะต ะฟะพััะตะฑะปะตะฝะธั ัะตััััะพะฒ, ะผะตััะธะบ ััะพะฒะฝั ะฝะพะด ะธ Pod'ะพะฒ, ะฐ ัะฐะบะถะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต Metrics-Server ะดะปั ัะฑะพัะฐ ะธ ะฐะณัะตะณะฐัะธะธ ะผะตััะธะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

---

<details>
<summary><b>๐ะะฐัะตะผ ะฝัะถะตะฝ ะผะพะฝะธัะพัะธะฝะณ ะฒ Kubernetes?</b></summary>

---

## ะงัะพ ะฝัะถะฝะพ ะพััะปะตะถะธะฒะฐัั?

ะะฐะบ ะฝะฐะผ ะพััะปะตะถะธะฒะฐัั ะฟะพััะตะฑะปะตะฝะธะต ัะตััััะพะฒ ะฒ Kubernetes? ะะปะธ, ััะพ ะฑะพะปะตะต ะฒะฐะถะฝะพ, ััะพ ะฝะฐะผ ะฟะพะปะตะทะฝะพ ะฑั ะฑัะปะพ ะพััะปะตะถะธะฒะฐัั?

ะะฐะบ ะผะธะฝะธะผัะผ, ัะพัะตะปะพัั ะฑั ะทะฝะฐัั:

### ะะพะบะฐะทะฐัะตะปะธ ััะพะฒะฝั ะฝะพะดั (ะธะฝััะฐััััะบัััะฐ)

โ **ะะพะปะธัะตััะฒะพ ัะทะปะพะฒ ะฒ ะบะปะฐััะตัะต:**
- ะกะบะพะปัะบะพ ะธะท ะฝะธั ะธัะฟัะฐะฒะฝะพ
- ะกะพััะพัะฝะธะต ัะทะปะพะฒ

โ **ะะพะบะฐะทะฐัะตะปะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ:**
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต CPU
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ
- ะะตััะพ ะฝะฐ ะดะธัะบะฐั
- ะัะพะฟััะบะฝะฐั ัะฟะพัะพะฑะฝะพััั ัะตัะธ

---

### ะะพะบะฐะทะฐัะตะปะธ ััะพะฒะฝั Pod

โ **ะะฝัะพัะผะฐัะธั ะพ Pod'ะฐั:**
- ะั ะบะพะปะธัะตััะฒะพ
- ะะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะบะฐะถะดะพะณะพ Pod'ะฐ

โ **ะะพััะตะฑะปะตะฝะธะต ัะตััััะพะฒ:**
- ะะพััะตะฑะปะตะฝะธะต CPU
- ะะพััะตะฑะปะตะฝะธะต ะฟะฐะผััะธ

---

### ะะพะบะฐะทะฐัะตะปะธ ััะพะฒะฝั ะฟัะธะปะพะถะตะฝะธั

โ **ะกะพััะพัะฝะธะต ะฟัะธะปะพะถะตะฝะธั:**
- ะะต ะฒััะปะพ ะปะธ ะพะฝะพ ะธะท ัััะพั
- ะัะฒะตัะฐะตั ะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะพัััะฟะฝะพััั ัะตัะฒะธัะฐ

---

## ะะตัะตะฝะธะต ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ

ะะพััะพะผั ะฝะฐะผ ะฝัะถะฝะพ ัะตัะตะฝะธะต, ะบะพัะพัะพะต ะฑัะดะตั:
- โ ะััะปะตะถะธะฒะฐัั ััะธ ะผะตััะธะบะธ
- โ ะฅัะฐะฝะธัั ะธั
- โ ะัะตะดะพััะฐะฒะปััั ะฐะฝะฐะปะธัะธะบั ะฝะฐ ะพัะฝะพะฒะต ััะธั ะดะฐะฝะฝัั

---

</details>

<details>
<summary><b>๐๏ธะะตัะตะฝะธั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ Kubernetes</b></summary>

---

## ะัััะพะตะฝะฝะพะต ัะตัะตะฝะธะต Kubernetes

ะะฐ ะผะพะผะตะฝั ัะพะทะดะฐะฝะธั ะบัััะฐ Kubernetes ะฝะต ะฟะพััะฐะฒะปัะตััั ั ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะผ ะฒัััะพะตะฝะฝัะผ ัะตัะตะฝะธะตะผ ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ.

---

## ะคะฐะบัะธัะตัะบะธะน ััะฐะฝะดะฐัั: Prometheus

ะขะตะผ ะฝะต ะผะตะฝะตะต, ัะฐะบัะธัะตัะบะธะผ ััะฐะฝะดะฐััะพะผ ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ััะฐะป Prometheus.

ะญัะพะผั ัะฟะพัะพะฑััะฒัะตั:
- ะกะพะพะฑัะตััะฒะพ ัะฐะทัะฐะฑะพััะธะบะพะฒ Kubernetes
- ะะพะดะดะตัะถะบะฐ ะธะฝัะตะณัะฐัะธะธ ั ะฝะธะผ ะฟัะฐะบัะธัะตัะบะธ "ะธะท ะบะพัะพะฑะบะธ"

---

## ะะพัััะฟะฝัะต ัะตัะตะฝะธั

ะกะตะณะพะดะฝั ะดะพัััะฟะตะฝ ััะด ัะตัะตะฝะธะน:

### ะะตัะตะฝะธั ั ะพัะบััััะผ ะธััะพะดะฝัะผ ะบะพะดะพะผ

โ **Metrics-Server**
- ะฃะฟัะพัะตะฝะฝะฐั ะฒะตััะธั ะดะปั ะฑะฐะทะพะฒะพะณะพ ะผะพะฝะธัะพัะธะฝะณะฐ
- ะะฐะฑะพัะฐะตั ะฒ ะฟะฐะผััะธ (in-memory)

โ **Prometheus**
- ะคะฐะบัะธัะตัะบะธะน ััะฐะฝะดะฐัั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ Kubernetes
- ะกะฑะพั, ััะฐะฝะตะฝะธะต ะธ ะทะฐะฟัะพั ะผะตััะธะบ

โ **Elastic Stack**
- Elasticsearch, Logstash, Kibana
- ะะปั ะปะพะณะพะฒ ะธ ะผะตััะธะบ

---

### ะัะพะฟัะธะตัะฐัะฝัะต ัะตัะตะฝะธั

โ **ะงะฐััะธัะฝะพ ะฟัะพะฟัะธะตัะฐัะฝัะต:**
- Dynatrace

โ **ะะตััะบะพ ะฟัะพะฟัะธะตัะฐัะฝัะต:**
- Datadog

---

</details>

<details>
<summary><b>๐๏ธะขะธะฟะพะฒะฐั ััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ</b></summary>

---

## ะััะธัะตะบัััะฐ ะผะพะฝะธัะพัะธะฝะณะฐ

ะขะธะฟะพะฒะฐั ััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ะฟะพะบะฐะทะฐะฝะฐ ะทะดะตัั.

ะ ัะธะปั ะดะธะฝะฐะผะธัะฝะพััะธ ะบะปะฐััะตัะฐ ะฒ ะฝะตะผ ะดะตะนััะฒััั ัะฐะทะฝัะต ัะตัะตะฝะธั, ะพะฑัะปัะถะธะฒะฐััะธะต ัะฐะทะฝัะต ะพะฑะปะฐััะธ ะพัะฒะตัััะฒะตะฝะฝะพััะธ ะฒ ัะฐััะธ ะผะพะฝะธัะพัะธะฝะณะฐ.

---

## ะขะธะฟะธัะฝัะต ััะฝะบัะธะธ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ะขะธะฟะพะฒะฐั ััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                          โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ  โ  ะัะธะปะพะถะตะฝะธั โ                                        โ
โ  โ     ะธ       โ                                        โ
โ  โ     ะะพะดั    โ                                        โ
โ  โโโโโโโโฌโโโโโโโ                                        โ
โ         โ                                               โ
โ         โผ                                               โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                   โ
โ  โ  Prometheus  โ  โ Metrics      โ                   โ
โ  โ              โ  โ Server       โ                   โ
โ  โ  - ะกะฑะพั      โ  โ              โ                   โ
โ  โ  - ะะณัะตะณะฐัะธั โ  โ - ะะณัะตะณะฐัะธั  โ                   โ
โ  โ  - ะัะตะผะตะฝะฝะพะต โ  โ - In-memory  โ                   โ
โ  โ    ััะฐะฝะตะฝะธะต  โ  โ              โ                   โ
โ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ                   โ
โ         โ                 โ                            โ
โ         โโโโโโโโโโโโโโโโโโโค                            โ
โ         โ                 โ                            โ
โ         โผ                 โผ                            โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                   โ
โ  โ   Grafana    โ  โ  Victoria    โ                   โ
โ  โ              โ  โ  Metrics      โ                   โ
โ  โ  - ะัะพัะผะพัั  โ  โ              โ                   โ
โ  โ  - ะะธะทัะฐะปะธะท. โ  โ - ะะพะปะณะพััะพั. โ                   โ
โ  โ              โ  โ   ััะฐะฝะตะฝะธะต   โ                   โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                   โ
โ                                                          โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ  โ  Alerting    โ                                        โ
โ  โ  - ะะปะตััะธะฝะณ  โ                                        โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะขะธะฟะธัะฝัะต ััะฝะบัะธะธ:
1. **ะกะฑะพั ะดะฐะฝะฝัั** โ ะฟะพะปััะตะฝะธะต ะผะตััะธะบ ั ะฟัะธะปะพะถะตะฝะธะน ะธ ะฝะพะด
2. **ะะณัะตะณะฐัะธั** โ ะพะฑัะตะดะธะฝะตะฝะธะต ะธ ะพะฑัะฐะฑะพัะบะฐ ะผะตััะธะบ
3. **ะัะตะผะตะฝะฝะพะต ััะฐะฝะตะฝะธะต** โ ะบัะฐัะบะพััะพัะฝะพะต ััะฐะฝะตะฝะธะต ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ
4. **ะะพะปะณะพััะพัะฝะพะต ััะฐะฝะตะฝะธะต** โ ะดะพะปะณะพััะพัะฝะพะต ััะฐะฝะตะฝะธะต ะดะปั ะธััะพัะธัะตัะบะธั ะดะฐะฝะฝัั
5. **ะัะพัะผะพัั** โ ะฒะธะทัะฐะปะธะทะฐัะธั ะผะตััะธะบ
6. **ะะปะตััะธะฝะณ** โ ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฟัะพะฑะปะตะผะฐั
7. **ะะฝะฐะปะธะท** โ ะฐะฝะฐะปะธะท ะฝะฐะบะพะฟะปะตะฝะฝัั ะดะฐะฝะฝัั

---

## ะะพะผะฟะพะฝะตะฝัั ััะตะผั

ะะฐ ััะพะน ััะตะผะต ั ะฝะฐั ะทะฐะดะตะนััะฒะพะฒะฐะฝั:

### Prometheus

- โ ะกะฝะธะผะฐะตั ะดะฐะฝะฝัะต ั ะฟัะธะปะพะถะตะฝะธะน ะธ ะฟะพะบะฐะทะฐะฝะธั ะฝะพะด
- โ ะะฐะฑะพัะธััั ะพ ะฒัะดะฐัะต ะดะฐะฝะฝัั ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะฒ Grafana
- โ ะัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต ะฝะฐ ััะฐะฝะตะฝะธะต ะฒ Victoria Metrics

### Metrics Server

- โ ะะฐะฑะพัะฐะตั ะฒ ัะฒัะทะบะต ั Prometheus
- โ ะะณะพ ะทะฐะดะฐัะตะน ัะฒะปัะตััั ะฑััั ะธััะพัะฝะธะบะพะผ ะธะฝัะพัะผะฐัะธะธ ะดะปั ะฐะฒัะพัะบะตะนะปะตัะฐ Kubernetes
- โ Horizontal Pod Autoscaler ะธัะฟะพะปัะทัะตั Metrics Server

---

## ะญัะฐะปะพะฝะฝัะต ะฐััะธัะตะบัััั

ะะพะณะดะฐ ัั ะฑัะดะตัั ะธัะบะฐัั ััะฐะปะพะฝะฝัะต ะฐััะธัะตะบัััั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ Kubernetes, ัั ะฝะฐะนะดะตัั ะผะฝะพะณะพ ัะฟัะฐะฒะพัะฝัั ะผะฐัะตัะธะฐะปะพะฒ ะฒ ะะฝัะตัะฝะตัะต.

---

</details>

<details>
<summary><b>๐ฏะขัะธ "A" ะผะพะฝะธัะพัะธะฝะณะฐ</b></summary>

---

## ะะพะฝัะตะฟัะธั ััะตั "A"

ะะพ ะทะฐะดะฐัะฐะผ ะผะพะฝะธัะพัะธะฝะณะฐ ั ะฑั ัะบะฐะทะฐะป, ััะพ ััะพ ััะธ "A":

---

### 1. Alerting (ะะปะตััะธะฝะณ)

ะั ััั ะฟะพะฝััะฝะพ:
- ะัะปะธ ััะพ-ัะพ ัะปะพะผะฐะปะพัั, ะผั ะฑั ะพะฑ ััะพะผ ะทะฝะฐะปะธ
- ะกะผะพะณะปะธ ะพััะตะฐะณะธัะพะฒะฐัั
- ะะพะปััะธะปะธ ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะฟัะพะฑะปะตะผะต

ะัะธะผะตัั:
- ะฃะทะตะป ะฝะตะดะพัััะฟะตะฝ
- Pod ะฝะต ะทะฐะฟััะบะฐะตััั
- ะัะตะฒััะตะฝะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต CPU
- ะะตะดะพััะฐัะพัะฝะพ ะฟะฐะผััะธ

---

### 2. Analytics (ะะฝะฐะปะธัะธะบะฐ)

ะญัะพ ะฒะพะทะผะพะถะฝะพััั ะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะฝะฐะบะพะฟะปะตะฝะฝัะน ะผะฐััะธะฒ ะดะฐะฝะฝัั.

ะะท ะฝะตะณะพ ัะฐะทะฝัะต ะณััะฟะฟั ะฒัะฝะพััั ัะฒะพะต:

#### ะะธะทะฝะตั
- ะะดะต ะพะฝ ะทะฐัะฐะฑะฐััะฒะฐะตั, ะฐ ะณะดะต ัะตััะตั
- ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฟัะธะปะพะถะตะฝะธะน
- ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ะพะฟัั

#### ะะดะผะธะฝั ะธ ัะตะบัััะธัะธ
- ะะตััะธะธ ะะ
- Vulnerabilities (ััะทะฒะธะผะพััะธ)
- ะกะพะพัะฒะตัััะฒะธะต ะฟะพะปะธัะธะบะฐะผ ะฑะตะทะพะฟะฐัะฝะพััะธ

#### SRE (Site Reliability Engineering)
- ะกะพะฑะปัะดะตะฝะธะต SLO (Service Level Objectives)
- ะัะพัะธะน UX (User Experience)
- ะะพัััะฟะฝะพััั ัะตัะฒะธัะพะฒ

ะ ะตัะต ะผั ัะฐะผ ะฒะธะดะธะผ:
- ะกะพััะพัะฝะธะต ะฝะฐัะตะน ะธะฝััะฐััััะบัััั ะฒ ะดะธะฝะฐะผะธะบะต
- ะะพะณะดะฐ ะพะฝะฐ ะฒัะฒะพะทะธั, ะฐ ะบะพะณะดะฐ ะฝะตั
- ะะดะต ะตะต ัะทะบะธะต ะผะตััะฐ

---

### 3. Autoscaling (ะะฒัะพะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต)

ะงัะพ ะฝะธ ะฝะฐ ะตััั ัะฐะผะฐั ะฟัะธะบะปะฐะดะฝะฐั ะดะปั Kubernetes.

ะั ะผะตััะธะบ CPU ะธ ะฟะฐะผััะธ ัะฐะฑะพัะฐะตั Horizontal Pod Autoscaler:
- ะะพัะพััะน ัะฟัะฐะฒะปัะตั ะบะพะปะธัะตััะฒะพะผ ัะตะฟะปะธะบ ะฒ Deployment
- ะขะตะผ ัะฐะผัะผ ะพะฑะตัะฟะตัะธะฒะฐั ัะฐะฑะพัั ะฟะพะด ะธะทะผะตะฝัััะธะผัั demand (ะฝะฐะณััะทะบะพะน)

ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั:
- Metrics Server ัะพะฑะธัะฐะตั ะผะตััะธะบะธ CPU ะธ ะฟะฐะผััะธ
- HPA ะฐะฝะฐะปะธะทะธััะตั ััะธ ะผะตััะธะบะธ
- ะัะธ ะฟัะตะฒััะตะฝะธะธ ะฟะพัะพะณะพะฒ ัะฒะตะปะธัะธะฒะฐะตั ะบะพะปะธัะตััะฒะพ ัะตะฟะปะธะบ
- ะัะธ ัะฝะธะถะตะฝะธะธ ะฝะฐะณััะทะบะธ ัะผะตะฝััะฐะตั ะบะพะปะธัะตััะฒะพ ัะตะฟะปะธะบ

---

</details>

<details>
<summary><b>๐Metrics-Server</b></summary>

---

## ะััะพัะธั: ะพั Heapster ะบ Metrics-Server

**Heapster** ะฑัะป ะพะดะฝะธะผ ะธะท ะฟะตัะฒัั ะฟัะพะตะบัะพะฒ, ะฒ ะบะพัะพัะพะผ ะฑัะปะธ ัะตะฐะปะธะทะพะฒะฐะฝั ััะฝะบัะธะธ ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ะฐะฝะฐะปะธะทะฐ ะดะปั Kubernetes.

ะะดะฝะฐะบะพ:
- โ ะขะตะฟะตัั Heapster ัััะฐัะตะป
- โ ะัะปะฐ ัะพะทะดะฐะฝะฐ ัะฟัะพัะตะฝะฝะฐั ะฒะตััะธั, ะธะทะฒะตััะฝะฐั ะบะฐะบ **Metrics-Server**

---

## ะงัะพ ัะฐะบะพะต Metrics-Server?

ะฃ ะฝะฐั ะผะพะถะตั ะฑััั ะพะดะธะฝ Metrics-Server ะฝะฐ ะบะปะฐััะตั.

Metrics-Server:
- โ ะะพะปััะฐะตั ะผะตััะธะบะธ ะพั ะบะฐะถะดะพะณะพ ะธะท ัะทะปะพะฒ ะธ Pod'ะพะฒ
- โ ะะณัะตะณะธััะตั ะธั
- โ ะกะพััะฐะฝัะตั ะฒ ะฟะฐะผััะธ

---

## ะะฐะถะฝะพะต ะพะณัะฐะฝะธัะตะฝะธะต

ะะฑัะฐัะธ ะฒะฝะธะผะฐะฝะธะต, ััะพ ัะตัะฒะตั ะผะตััะธะบ โ ััะพ ัะพะปัะบะพ ัะตัะตะฝะธะต ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ in-memory.

ะะฝ ะฝะต ััะฐะฝะธั ะผะตััะธะบะธ ะฒ ะฟะพััะพัะฝะฝะพะผ ััะฐะฝะธะปะธัะต.

ะ ัะตะทัะปััะฐัะต:
- โ ะั ะผะพะถะตะผ ะฒะธะดะตัั ะปะธัั ะพัะตะฝั ะบะพัะพัะบะธะน ะฟัะพะผะตะถััะพะบ ะดะฐะฝะฝัั
- โ ะะตะท ะฒะพะทะผะพะถะฝะพััะธ ะฟะพะปััะธัั ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต ะพ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

ะะปั ััะพะณะพ ะผั ะดะพะปะถะฝั ะฟะพะปะพะถะธัััั ะฝะฐ ะพะดะฝะพ ะธะท ะฑะพะปะตะต ะบััััั ัะตัะตะฝะธะน ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ:
- Prometheus
- Victoria Metrics
- Elastic Stack
- ะ ะดััะณะธะต

---

</details>

<details>
<summary><b>๐งะะฐะบ ะณะตะฝะตัะธัััััั ะผะตััะธะบะธ?</b></summary>

---

## ะะฒะฐ ะธััะพัะฝะธะบะฐ ะผะตััะธะบ

ะขะฐะบ ะบะฐะบ ะถะต ะณะตะฝะตัะธัััััั ะผะตััะธะบะธ ะดะปั Pod'ะพะฒ ะธ nodes?

ะกััะตััะฒััั ะดะฒะฐ ะธััะพัะฝะธะบะฐ:

---

### 1. Monitoring Pipeline

ะะตัะฒัะน ะธะทะฒะตััะตะฝ ะบะฐะบ Monitoring Pipeline.

ะญัะพ ะดะฐะฝะฝัะต ะพ:
- CPU ะฝะพะดั
- ะะฐะผััั ะฝะพะดั

ะััะพัะฝะธะบ: ะกะธััะตะผะฝัะต ะผะตััะธะบะธ ัะทะปะฐ

---

### 2. Core Metrics Pipeline (cAdvisor)

ะัะพัะพะน ะธััะพัะฝะธะบ ะฟัะธะฒะปะตะบะฐะตั ะดะปั ัะฐะฑะพัั ะบะพะผะฟะพะฝะตะฝั Kubernetes, ะบะพัะพััะน ะทะฐะฟััะตะฝ ะฒ ะบะฐัะตััะฒะต ะฐะณะตะฝัะฐ ะฝะฐ ะบะฐะถะดะพะผ ัะทะปะต.

ะขั ะตะณะพ ะทะฝะฐะตัั โ ััะพ kubelet.

ะฃ kubelet ะตััั ะฟะพะดะบะพะผะฟะพะฝะตะฝั, ะธะทะฒะตััะฝัะน ะบะฐะบ cAdvisor ะธะปะธ Container Advisor.

cAdvisor ะพัะฒะตัะฐะตั ะทะฐ:
- โ ะะพะปััะตะฝะธะต ะผะตััะธะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธะท Pod
- โ ะัะฟัะฐะฒะบั ะธั ัะตัะตะท API kubelet

ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ััะธ ะผะตััะธะบะธ ััะฐะฝะพะฒัััั ะดะพัััะฟะฝัะผะธ ะดะปั ัะตัะฒะตัะฐ ะผะตััะธะบ.

ะญัะพั ะธััะพัะฝะธะบ ะฝะฐะทัะฒะฐะตััั Core Metrics Pipeline.

---

## ะกัะตะผะฐ ัะฑะพัะฐ ะผะตััะธะบ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ะกัะตะผะฐ ัะฑะพัะฐ ะผะตััะธะบ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                          โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ  โ    Node      โ                                        โ
โ  โ              โ                                        โ
โ  โ  โโโโโโโโโโ  โ                                        โ
โ  โ  โ Pod 1  โ  โ                                        โ
โ  โ  โ Pod 2  โ  โ                                        โ
โ  โ  โโโโโฌโโโโโ  โ                                        โ
โ  โ      โ       โ                                        โ
โ  โ      โผ       โ                                        โ
โ  โ  โโโโโโโโโโ  โ                                        โ
โ  โ  โkubelet โ  โ                                        โ
โ  โ  โ        โ  โ                                        โ
โ  โ  โcAdvisorโ  โ  Core Metrics Pipeline               โ
โ  โ  โโโโโฌโโโโโ  โ  (ะผะตััะธะบะธ Pod'ะพะฒ)                     โ
โ  โ      โ       โ                                        โ
โ  โโโโโโโโผโโโโโโโโ                                        โ
โ         โ                                               โ
โ         โผ                                               โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ  โ   Metrics    โ                                        โ
โ  โ   Server     โ                                        โ
โ  โ              โ                                        โ
โ  โ  - ะะณัะตะณะฐัะธั โ                                        โ
โ  โ  - In-memory โ                                        โ
โ  โโโโโโโโโโโโโโโโ                                        โ
โ                                                          โ
โ  Monitoring Pipeline (ะผะตััะธะบะธ ะฝะพะดั)                     โ
โ         โ                                               โ
โ         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

</details>

<details>
<summary><b>๐ะะฐะทะฒะตัััะฒะฐะฝะธะต Metrics-Server</b></summary>

---

## ะะปั minikube

ะัะปะธ ัั ะธัะฟะพะปัะทัะตัั minikube ะฝะฐ ัะฒะพะตะผ ะปะพะบะฐะปัะฝะพะผ ะบะปะฐััะตัะต:

```bash
minikube addons enable metrics-server
```

ะญัะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฒะตัะฝะตั Metrics-Server ะฒ ะบะปะฐััะตัะต minikube.

---

## ะะปั ะฒัะตั ะพััะฐะปัะฝัั ััะตะด

ะะปั ะฒัะตั ะพััะฐะปัะฝัั ััะตะด ัะฐะทะฒะตัะฝะธ Metrics-Server ะฟััะตะผ ะทะฐะฟััะบะฐ ะผะฐะฝะธัะตััะฐ:

```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

ะญัะฐ ะบะพะผะฐะฝะดะฐ ัะฐะทะฒะตัััะฒะฐะตั:
- โ Deployment
- โ Services
- โ Roles

ะงัะพะฑั Metrics-Server ัะผะพะณ ะทะฐะฟัะฐัะธะฒะฐัั ะผะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ั ัะทะปะพะฒ ะฒ ะบะปะฐััะตัะต.

---

## ะะถะธะดะฐะฝะธะต ัะฑะพัะฐ ะดะฐะฝะฝัั

ะะพัะปะต ัะฐะทะฒะตัััะฒะฐะฝะธั ะดะฐะน ัะตัะฒะตัั ะผะตััะธะบ ะฝะตะบะพัะพัะพะต ะฒัะตะผั ะดะปั ัะฑะพัะฐ ะธ ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั.

ะะฑััะฝะพ ััะพ ะทะฐะฝะธะผะฐะตั ะฝะตัะบะพะปัะบะพ ะผะธะฝัั.

ะัะพะฒะตัะบะฐ ััะฐัััะฐ:

```bash
kubectl get deployment metrics-server -n kube-system
```

ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ:

```bash
kubectl logs -n kube-system deployment/metrics-server
```

---

</details>

<details>
<summary><b>๐ะัะพัะผะพัั ะผะตััะธะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ</b></summary>

---

## ะะตััะธะบะธ ัะทะปะพะฒ

**ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะบะปะฐััะตัะฐ ะผะพะถะฝะพ ัะฒะธะดะตัั, ะฒัะฟะพะปะฝะธะฒ ะบะพะผะฐะฝะดั:**

```bash
kubectl top node
```

**ะญัะพ ะฟะพะบะฐะถะตั ะฟะพััะตะฑะปะตะฝะธะต ัะตััััะพะฒ CPU ะธ ะฟะฐะผััะธ ะดะปั ะบะฐะถะดะพะณะพ ะธะท ัะทะปะพะฒ.**

**ะัะธะผะตั ะฒัะฒะพะดะฐ:**

```
NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
master-node    155m         7%     1024Mi          25%
worker-node-1  200m         10%    2048Mi          30%
worker-node-2  180m         9%    1536Mi          22%
```

**ะะฐะบ ะฒะธะดะธัั, ะฝะฐ ะผะพะตะผ ะผะฐััะตัะต ะธัะฟะพะปัะทัะตััั 7% CPU, ััะพ ัะพััะฐะฒะปัะตั ะพะบะพะปะพ 155 ะผะธะปะปะธัะดั.**

---

## ะะตััะธะบะธ Pod'ะพะฒ

ะัะฟะพะปัะทัะน ะบะพะผะฐะฝะดั ะดะปั ะฟัะพัะผะพััะฐ ะฟะพะบะฐะทะฐัะตะปะตะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ Pod'ะพะฒ:

```bash
kubectl top pod
```

ะะปั ะบะพะฝะบัะตัะฝะพะณะพ namespace:

```bash
kubectl top pod -n <namespace>
```

ะัะธะผะตั ะฒัะฒะพะดะฐ:

```
NAME                          CPU(cores)   MEMORY(bytes)
nginx-deployment-7d4b8c9f-abc   10m         50Mi
nginx-deployment-7d4b8c9f-def   12m         55Mi
app-pod-1                       5m          30Mi
```

---

## ะัะพัะผะพัั ะผะตััะธะบ ะบะพะฝะบัะตัะฝะพะณะพ Pod'ะฐ

ะะปั ะฟัะพัะผะพััะฐ ะผะตััะธะบ ะบะพะฝะบัะตัะฝะพะณะพ Pod'ะฐ:

```bash
kubectl top pod <pod-name> -n <namespace>
```

---

</details>

<details>
<summary><b>โ๏ธะัะพะฑะปะตะผั ั Metrics-Server</b></summary>

---

## ะัะพะฑะปะตะผะฐ: Metrics-Server ะฝะต ััะฐัััะตั

ะัะปะธ ัั ะฒะธะดะธัั, ััะพ ัะตัะฒะตั ะผะตััะธะบ ะฝะต ััะฐัััะตั, ะฟัะพะฒะตัั ะตะณะพ ะบะพะฝัะธะณััะฐัะธั.

ะะพ ััะพะน ัััะปะบะต ัะฐัะฟะธัะฐะฝะพ, ะบะฐะบ ะตะณะพ ะฝะฐัััะพะธัั:
- [ะัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั Metrics-Server](https://github.com/kubernetes-sigs/metrics-server)

---

## ะัะพะฑะปะตะผั ั ัะตััะธัะธะบะฐัะฐะผะธ

ะั ัะตะฑั ัะบะฐะถั, ััะพ ะฒ 90% ัะปััะฐะตะฒ ััะพ ะฟัะพะฑะปะตะผั ั ัะตััะธัะธะบะฐัะฐะผะธ.

ะะตัะตะฝะธั:

### ะะฐัะธะฐะฝั 1: ะัะฟัััะธัั ะพัะดะตะปัะฝัะต ัะตััะธัะธะบะฐัั ะดะปั Metrics-Server

ะะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ัะตััะธัะธะบะฐัั kube-apiserver.

ะะปั ััะพะณะพ ะพััะตะดะฐะบัะธััะน deployment ะฒ ัะฐะนะปะต `components.yaml`:
- ะะต ะทะฐะฑัะดั ะฟะพะดะบะปััะธัั ัะพะผะฐ ั ัะตััะธัะธะบะฐัะฐะผะธ ะฒ ะบะพะฝัะตะนะฝะตั ัะตัะฒะตัะฐ ะผะตััะธะบ

ะัะธะผะตั:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - name: metrics-server
        volumeMounts:
        - name: ca-cert
          mountPath: /etc/ssl/certs
          readOnly: true
      volumes:
      - name: ca-cert
        hostPath:
          path: /etc/ssl/certs
```

---

### ะะฐัะธะฐะฝั 2: ะัััััะน ะพะฑัะพะดะฝะพะน ะฒะฐัะธะฐะฝั

ะัะฟะพะปัะทัะน ะบะปัั `--kubelet-insecure-tls`.

ะญัะพ ะพัะบะปััะฐะตั ะฟัะพะฒะตัะบั TLS ัะตััะธัะธะบะฐัะพะฒ kubelet.

โ๏ธ **ะะฝะธะผะฐะฝะธะต:** ะัะฟะพะปัะทัะน ััะพ ัะพะปัะบะพ ะดะปั ัะตััะธัะพะฒะฐะฝะธั, ะฝะต ะฒ production!

ะะพะฑะฐะฒั ะฐัะณัะผะตะฝั ะฒ deployment:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - name: metrics-server
        args:
        - --kubelet-insecure-tls
        # ะดััะณะธะต ะฐัะณัะผะตะฝัั...
```

---

## ะัะพะฒะตัะบะฐ ะฟัะพะฑะปะตะผั

ะัะพะฒะตัั ะปะพะณะธ Metrics-Server:

```bash
kubectl logs -n kube-system deployment/metrics-server
```

ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ:
- `x509: certificate signed by unknown authority` โ ะฟัะพะฑะปะตะผะฐ ั ัะตััะธัะธะบะฐัะฐะผะธ
- `connection refused` โ kubelet ะฝะตะดะพัััะฟะตะฝ
- `timeout` โ ะฟัะพะฑะปะตะผั ั ัะตััั

---

</details>

---

## ะะตะทัะผะต

โ **ะะพะฝะธัะพัะธะฝะณ Kubernetes ะฝะตะพะฑัะพะดะธะผ ะดะปั:**
- ะััะปะตะถะธะฒะฐะฝะธั ะฟะพััะตะฑะปะตะฝะธั ัะตััััะพะฒ
- ะะพะบะฐะทะฐัะตะปะตะน ััะพะฒะฝั ะฝะพะด (CPU, ะฟะฐะผััั, ะดะธัะบ, ัะตัั)
- ะะพะบะฐะทะฐัะตะปะตะน ััะพะฒะฝั Pod'ะพะฒ (ะบะพะปะธัะตััะฒะพ, CPU, ะฟะฐะผััั)
- ะกะพััะพัะฝะธั ะฟัะธะปะพะถะตะฝะธะน (ะดะพัััะฟะฝะพััั, ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััั)

โ **ะะตัะตะฝะธั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ:**
- **Prometheus** โ ัะฐะบัะธัะตัะบะธะน ััะฐะฝะดะฐัั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ Kubernetes
- **Metrics-Server** โ ัะฟัะพัะตะฝะฝะพะต ัะตัะตะฝะธะต ะดะปั ะฑะฐะทะพะฒะพะณะพ ะผะพะฝะธัะพัะธะฝะณะฐ (in-memory)
- **Elastic Stack, Dynatrace, Datadog** โ ะฐะปััะตัะฝะฐัะธะฒะฝัะต ัะตัะตะฝะธั

โ **ะขัะธ "A" ะผะพะฝะธัะพัะธะฝะณะฐ:**
- **Alerting** โ ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฟัะพะฑะปะตะผะฐั
- **Analytics** โ ะฐะฝะฐะปะธะท ะฝะฐะบะพะฟะปะตะฝะฝัั ะดะฐะฝะฝัั
- **Autoscaling** โ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฝะฐ ะพัะฝะพะฒะต ะผะตััะธะบ

โ **Metrics-Server:**
- ะฃะฟัะพัะตะฝะฝะฐั ะฒะตััะธั ัััะฐัะตะฒัะตะณะพ Heapster
- ะะดะธะฝ Metrics-Server ะฝะฐ ะบะปะฐััะตั
- ะะพะปััะฐะตั ะผะตััะธะบะธ ะพั ัะทะปะพะฒ ะธ Pod'ะพะฒ
- ะะณัะตะณะธััะตั ะธ ัะพััะฐะฝัะตั ะฒ ะฟะฐะผััะธ (in-memory)
- ะะต ััะฐะฝะธั ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต

โ **ะััะพัะฝะธะบะธ ะผะตััะธะบ:**
- **Monitoring Pipeline** โ ะดะฐะฝะฝัะต ะพ CPU ะธ ะฟะฐะผััะธ ะฝะพะดั
- **Core Metrics Pipeline (cAdvisor)** โ ะผะตััะธะบะธ Pod'ะพะฒ ัะตัะตะท kubelet

โ **ะะฐะทะฒะตัััะฒะฐะฝะธะต:**
- Minikube: `minikube addons enable metrics-server`
- ะััะณะธะต ััะตะดั: `kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml`

โ **ะัะพัะผะพัั ะผะตััะธะบ:**
- `kubectl top node` โ ะผะตััะธะบะธ ัะทะปะพะฒ
- `kubectl top pod` โ ะผะตััะธะบะธ Pod'ะพะฒ

โ **ะัะพะฑะปะตะผั:**
- ะ 90% ัะปััะฐะตะฒ ะฟัะพะฑะปะตะผั ั ัะตััะธัะธะบะฐัะฐะผะธ
- ะะตัะตะฝะธั: ะฝะฐัััะพะธัั ัะตััะธัะธะบะฐัั ะธะปะธ ะธัะฟะพะปัะทะพะฒะฐัั `--kubelet-insecure-tls` (ัะพะปัะบะพ ะดะปั ัะตััะธัะพะฒะฐะฝะธั)

> ๐ก **ะกะพะฒะตั:** Metrics-Server โ ััะพ ะฑะฐะทะพะฒะพะต ัะตัะตะฝะธะต ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ. ะะปั ะฟะพะปะฝะพัะตะฝะฝะพะณะพ ะผะพะฝะธัะพัะธะฝะณะฐ ั ะธััะพัะธัะตัะบะธะผะธ ะดะฐะฝะฝัะผะธ ะธัะฟะพะปัะทัะนัะต Prometheus ะธะปะธ ะดััะณะธะต ัะตัะตะฝะธั. Metrics-Server ะฝะตะพะฑัะพะดะธะผ ะดะปั ัะฐะฑะพัั Horizontal Pod Autoscaler.

---

