[🏠 Главная](../../README.md) → [☸️ Container-Orchestration](../../README.md#-container-orchestration) → [💾 K-12-Хранение](../../README.md#-k-12-хранение)

---

# 💾K-12-3-Volume-Driver-Plugins-in-Docker
>Volume Driver Plugins в Docker: отличие от storage drivers, local plugin, сторонние плагины (RexRay, Azure, AWS EBS и др.), использование облачных хранилищ

**📍 Текущая тема**

---

<details>
<summary><b>📚Введение: Storage Drivers vs Volume Driver Plugins</b></summary>

---

## Связь с предыдущей темой

В теме [K-12-2-Storage-in-Docker](K-12-2-Storage-in-Docker.md) мы рассмотрели storage drivers — механизмы, которые управляют слоями файловой системы в образах и контейнерах Docker.

Также мы упомянули тома (volumes) как способ сохранения данных между перезапусками контейнеров.

---

## Важное различие

Важно понимать, что тома обрабатываются не storage drivers, а отдельными компонентами — **volume driver plugins**.

Это два разных уровня абстракции: storage drivers работают на уровне файловой системы, а volume driver plugins — на уровне томов.

### Сравнение Storage Drivers и Volume Driver Plugins

```
┌─────────────────────────────────────────────────────────┐
│  Storage Drivers                                        │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Управляют слоями файловой системы               │   │
│  │  - Слои образов (read-only)                      │   │
│  │  - Слои контейнеров (read-write)                 │   │
│  │  - Copy-on-Write механизм                        │   │
│  │  - overlay2, aufs, devicemapper и т.д.          │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Volume Driver Plugins                          │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  Управляют томами (volumes)                 │ │   │
│  │  │  - Локальные тома                            │ │   │
│  │  │  - Облачные хранилища                        │ │   │
│  │  │  - Сетевые хранилища                         │ │   │
│  │  │  - local, rexray, azure и т.д.              │ │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

---

## Ключевые отличия

| Аспект | Storage Drivers | Volume Driver Plugins |
|--------|----------------|----------------------|
| **Назначение** | Управление слоями образов и контейнеров | Управление томами для постоянного хранения |
| **Уровень** | Низкоуровневый (файловая система) | Высокоуровневый (тома) |
| **Данные** | Временные данные контейнера | Постоянные данные приложения |
| **Примеры** | overlay2, aufs, devicemapper | local, rexray, azure |

---

</details>

<details>
<summary><b>🏠Local Volume Driver Plugin</b></summary>

---

## Плагин по умолчанию

По умолчанию Docker использует плагин **local** для работы с томами.

Этот плагин создает тома непосредственно на хосте Docker и хранит данные в каталоге `/var/lib/docker/volumes`.

---

## Как работает Local Plugin

### Схема работы Local Volume Driver

```
┌─────────────────────────────────────────────────────────┐
│  Docker Host                                             │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Local Volume Driver Plugin                      │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  Создает тома в:                            │ │   │
│  │  │  /var/lib/docker/volumes/                   │ │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  /var/lib/docker/volumes/                        │   │
│  │  ├── volume1/                                    │   │
│  │  ├── volume2/                                    │   │
│  │  └── volume3/                                    │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        │ Монтирование                    │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Контейнер                                        │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  /data/ (смонтированный том)                │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

---

## Использование Local Plugin

Local plugin используется автоматически, когда вы создаете том без указания драйвера:

```bash
# Создание тома с local driver (по умолчанию)
docker volume create my_volume

# Явное указание local driver
docker volume create --driver local my_volume

# Использование тома в контейнере
docker run -v my_volume:/data alpine
```

---

## Характеристики Local Plugin

- **Простота** — не требует дополнительной настройки
- **Локальное хранение** — данные хранятся на том же хосте
- **Производительность** — высокая скорость доступа
- **Ограничение** — данные доступны только на одном хосте

---

</details>

<details>
<summary><b>🌐Сторонние Volume Driver Plugins</b></summary>

---

## Обзор сторонних плагинов

Помимо стандартного local плагина, существует множество сторонних volume driver plugins, которые позволяют интегрировать Docker с различными системами хранения данных.

Экосистема плагинов постоянно развивается, появляются новые решения для разных провайдеров и сценариев использования.

---

## Популярные Volume Driver Plugins

### Облачные провайдеры

- **Azure File Storage** — тома в Microsoft Azure
- **DigitalOcean Block Storage** — блочное хранилище DigitalOcean
- **gce persistent disk** — постоянные диски Google Cloud Platform
- **vSphere Storage** — хранилище VMware vSphere

### Сетевые хранилища

- **GlusterFS** — распределенная файловая система
- **NetApp** — сетевое хранилище NetApp
- **Convoy** — плагин для различных бэкендов

### Другие решения

- **Flocker** — оркестрация томов для контейнеров
- **Portworx** — облачное хранилище для контейнеров
- **RexRay** — универсальный плагин для множества провайдеров

### Схема различных Volume Driver Plugins

```
┌─────────────────────────────────────────────────────────┐
│  Docker Container                                       │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Volume (смонтированный)                         │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│        ┌───────────────┴───────────────┐               │
│        │                               │               │
│        ▼                               ▼               │
│  ┌──────────────┐            ┌──────────────────┐     │
│  │ Local Plugin │            │ Сторонние Plugins│     │
│  │              │            │                  │     │
│  │ /var/lib/    │            │ - RexRay         │     │
│  │ docker/      │            │ - Azure          │     │
│  │ volumes/     │            │ - AWS EBS       │     │
│  └──────────────┘            │ - GlusterFS      │     │
│                              │ - NetApp         │     │
│                              └──────────────────┘     │
│        │                               │               │
│        └───────────────┬───────────────┘               │
│                        ▼                               │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Внешние хранилища                                │   │
│  │  - Облачные провайдеры                            │   │
│  │  - Сетевые хранилища                              │   │
│  │  - Блочные хранилища                              │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

---

</details>

<details>
<summary><b>🔌RexRay: Универсальный Volume Driver</b></summary>

---

## Что такое RexRay

**RexRay** — это универсальный volume driver plugin, который поддерживает множество различных провайдеров хранилищ через единый интерфейс.

Этот плагин позволяет использовать различные системы хранения без необходимости устанавливать отдельные плагины для каждого провайдера. RexRay поддерживает следующие платформы:

### Поддерживаемые провайдеры RexRay

- **AWS**
  - EBS (Elastic Block Store)
  - EFS (Elastic File System)
  - S3FS (S3 File System)

- **Dell EMC**
  - Isilon
  - ScaleIO

- **Google Cloud**
  - Persistent Disk

- **OpenStack**
  - Cinder

### Схема работы RexRay

```
┌─────────────────────────────────────────────────────────┐
│  Docker Container                                       │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Volume (смонтированный через RexRay)            │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  RexRay Volume Driver Plugin                     │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  Универсальный интерфейс для:               │ │   │
│  │  │  - AWS EBS/EFS/S3FS                         │ │   │
│  │  │  - Dell EMC Isilon/ScaleIO                  │ │   │
│  │  │  - Google Persistent Disk                   │ │   │
│  │  │  - OpenStack Cinder                         │ │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│        ┌───────────────┴───────────────┐               │
│        ▼                               ▼               │
│  ┌──────────────┐            ┌──────────────────┐     │
│  │ AWS EBS       │            │ Google Persistent│     │
│  │ (облако)      │            │ Disk (облако)     │     │
│  └──────────────┘            └──────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

---

## Преимущества RexRay

- **Универсальность** — один плагин для множества провайдеров
- **Гибкость** — легко переключаться между провайдерами
- **Стандартизация** — единый интерфейс для разных хранилищ

---

</details>

<details>
<summary><b>☁️Пример: Использование AWS EBS</b></summary>

---

## Создание тома в облаке

Для использования облачных хранилищ необходимо указать соответствующий volume driver plugin при создании тома.

Например, для работы с Amazon EBS можно использовать плагин `rexray/ebs`. При этом том создается непосредственно в облаке AWS, а данные остаются доступными даже после остановки или удаления контейнера.

---

## Пример использования

### Установка RexRay с поддержкой AWS EBS

```bash
# Установка RexRay плагина
docker plugin install rexray/ebs \
  EBS_ACCESSKEY=your_access_key \
  EBS_SECRETKEY=your_secret_key \
  EBS_REGION=us-east-1
```

### Создание тома с RexRay

```bash
# Создание тома в AWS EBS через RexRay
docker volume create --driver rexray/ebs \
  --opt size=10 \
  --opt volumetype=gp3 \
  my-ebs-volume
```

### Использование тома в контейнере

```bash
# Запуск контейнера с томом из AWS EBS
docker run -d \
  --name my-app \
  -v my-ebs-volume:/data \
  my-app-image
```

### Схема работы с AWS EBS

```
┌─────────────────────────────────────────────────────────┐
│  Docker Host                                             │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Контейнер my-app                                │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  /data/ (смонтированный том)                │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        │ RexRay Plugin                   │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  AWS EBS Volume (my-ebs-volume)                 │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │  Данные приложения (сохраняются в облаке)    │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
│                        │                                 │
│                        ▼                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Amazon Web Services (AWS)                      │   │
│  │  - Высокая доступность                          │   │
│  │  - Резервное копирование                        │   │
│  │  - Масштабируемость                             │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

---

## Преимущества облачных томов

- **Доступность** — данные доступны из любого места
- **Надежность** — облачные провайдеры обеспечивают высокую надежность
- **Масштабируемость** — легко увеличивать размер томов
- **Резервное копирование** — автоматические бэкапы от провайдера
- **Независимость от хоста** — данные сохраняются даже при удалении контейнера или хоста

---

</details>

<details>
<summary><b>📋Другие примеры Volume Driver Plugins</b></summary>

---

## Azure File Storage

```bash
# Установка Azure File Storage плагина
docker plugin install docker4x/cloudstor:azure \
  AZURE_STORAGE_ACCOUNT=your_account \
  AZURE_STORAGE_ACCOUNT_KEY=your_key

# Создание тома
docker volume create --driver docker4x/cloudstor:azure \
  --opt share=myshare \
  my-azure-volume
```

---

## GlusterFS

```bash
# Установка GlusterFS плагина
docker plugin install gluster/glusterfs-plugin

# Создание тома
docker volume create --driver gluster/glusterfs-plugin \
  --opt voluri=gluster-server:myvolume \
  my-gluster-volume
```

---

## Portworx

```bash
# Установка Portworx плагина
docker plugin install portworx/px-plugin

# Создание тома
docker volume create --driver portworx/px-plugin \
  --opt size=10 \
  --opt repl=3 \
  my-px-volume
```

---

## Сравнение плагинов

| Плагин | Тип хранилища | Использование |
|--------|--------------|---------------|
| local | Локальный диск | Разработка, простые приложения |
| rexray/ebs | AWS EBS | Производство в AWS |
| docker4x/cloudstor:azure | Azure File Storage | Производство в Azure |
| gluster/glusterfs-plugin | GlusterFS | Распределенное хранилище |
| portworx/px-plugin | Portworx | Контейнерное хранилище |

---

</details>

<details>
<summary><b>🔍Проверка установленных плагинов</b></summary>

---

## Список плагинов

Чтобы увидеть все установленные volume driver plugins:

```bash
# Список всех плагинов
docker plugin ls

# Детальная информация о плагине
docker plugin inspect <plugin_name>
```

---

## Пример вывода

```bash
$ docker plugin ls
NAME                  DESCRIPTION         ENABLED
rexray/ebs:latest     RexRay EBS plugin    true
local:latest         Local volume driver  true
```

---

## Проверка томов

```bash
# Список всех томов
docker volume ls

# Детальная информация о томе
docker volume inspect <volume_name>
```

---

</details>

---

## Резюме

### Storage Drivers vs Volume Driver Plugins

- **Storage Drivers** — управляют слоями файловой системы образов и контейнеров
- **Volume Driver Plugins** — управляют томами для постоянного хранения данных

### Local Volume Driver Plugin

- Плагин по умолчанию в Docker
- Хранит тома в `/var/lib/docker/volumes/`
- Простой и быстрый для локального использования

### Сторонние Volume Driver Plugins

- Позволяют использовать облачные и сетевые хранилища
- Примеры: RexRay, Azure, AWS EBS, GlusterFS, Portworx
- Обеспечивают высокую доступность и надежность данных

### Преимущества облачных томов

- Данные сохраняются независимо от контейнера
- Высокая доступность и надежность
- Масштабируемость
- Автоматическое резервное копирование

---

## Связанные темы

- **[K-12-1-Enter-Container-Storage](K-12-1-Enter-Container-Storage.md)** — введение в концепции хранения в Docker
- **[K-12-2-Storage-in-Docker](K-12-2-Storage-in-Docker.md)** — volumes в Docker
- **[K-12-3-Volume-Driver-Plugins-in-Docker](K-12-3-Volume-Driver-Plugins-in-Docker.md)** — volume driver plugins **← Текущая тема**
- **[K-12-4-CSI](K-12-4-CSI.md)** — Container Storage Interface
- **[K-12-5-Volumes](K-12-5-Volumes.md)** — volumes в Kubernetes, типы volumes и их использование
- **[K-12-6-Persistent-Volumes](K-12-6-Persistent-Volumes.md)** — Persistent Volumes, централизованное управление хранилищем
- **[K-12-7-Persistent-Volume-Claims](K-12-7-Persistent-Volume-Claims.md)** — Persistent Volume Claims, запросы на хранилище

---

## Что дальше?

В следующей теме [K-12-4-CSI](K-12-4-CSI.md) мы рассмотрим Container Storage Interface — универсальный стандарт, который позволяет различным оркестраторам контейнеров работать с любыми системами хранения через стандартизированный интерфейс.
