[🏠 Главная](../../README.md) → [☸️ Container-Orchestration](../../README.md#-container-orchestration) → [🌱 K-04-Ресурсы-Kubernetes](../../README.md#-k-04-ресурсы-kubernetes)

# 🌱K-04-1-Resource-Pods
>Pod — минимальная рабочая единица Kubernetes, инкапсулирует контейнеры, обеспечивает общее сетевое пространство и хранилище

<details>
<summary><b>🔍Что такое Pod?</b></summary>

---

**Pod** - это минимальная deployable единица в Kubernetes, которая:
- ✅ Инкапсулирует один или несколько контейнеров
- ✅ Предоставляет общее сетевое пространство (общий IP, localhost)
- ✅ Обеспечивает общее хранилище через volumes
- ✅ Имеет единый жизненный цикл для всех контейнеров

**Важно:** Kubernetes управляет Pod'ами, а не контейнерами напрямую.

---

</details>

<details>
<summary><b>📋Один vs Несколько контейнеров в Pod</b></summary>

---

### 🎯 Pod с одним контейнером (90% случаев)
```
apiVersion: v1
kind: Pod
metadata:
  name: single-container-pod
spec:
  containers:
  - name: app
    image: nginx:latest
```

```
# Схема: Один контейнер в Pod
Node1:
┌─────────────────┐
│      Pod A      │
│ ┌─────────────┐ │
│ │  Container  │ │
│ │   (nginx)   │ │
│ └─────────────┘ │
└─────────────────┘
```

**Используйте когда:**
- Запускаете одно приложение
- Масштабируете через репликацию Pod'ов

### 🔄 Pod с несколькими контейнерами (Sidecar pattern)
```
apiVersion: v1
kind: Pod
metadata:
  name: multi-container-pod
spec:
  containers:
  - name: app
    image: my-app:latest
  - name: log-agent
    image: logstash:latest
```

```
# Схема: Мультиконтейнерный Pod
┌─────────────────────────────────┐
│             Pod A               │
│ ┌─────────────┐ ┌─────────────┐ │
│ │  Основной   │ │   Агент     │ │
│ │ контейнер   │ │ мониторинга │ │
│ │  (приложение)│ │ (logstash)  │ │
│ └─────────────┘ └─────────────┘ │
│          Shared Volume          │
│        /var/log/app/           │
└─────────────────────────────────┘
```

**Используйте когда:**
- Нужен контейнер-помощник (мониторинг, обработка файлов)
- Контейнеры тесно связаны и имеют общий жизненный цикл
- Контейнеры взаимодействуют через localhost или общие тома

> ⚠️ **Важно:** Не используйте несколько контейнеров для масштабирования приложения!

---

</details>

<details>
<summary><b>🚀Масштабирование приложений</b></summary>

---

### ✅ Правильное масштабирование - новые Pods
```
# Схема: Масштабирование через новые Pods
Node1:                          Node2:
┌─────────────────┐             ┌─────────────────┐
│      Pod A      │             │      Pod C      │
│ ┌─────────────┐ │             │ ┌─────────────┐ │
│ │  Container  │ │             │ │  Container  │ │
│ │   (nginx)   │ │             │ │   (nginx)   │ │
│ └─────────────┘ │             │ └─────────────┘ │
└─────────────────┘             └─────────────────┘
┌─────────────────┐
│      Pod B      │
│ ┌─────────────┐ │
│ │  Container  │ │
│ │   (nginx)   │ │
│ └─────────────┘ │
└─────────────────┘
```

### ❌ Неправильное масштабирование - больше контейнеров в Pod
```
# Схема: ❌ НЕ делайте так для масштабирования!
Node1:
┌─────────────────┐
│      Pod A      │
│ ┌─────────────┐ │
│ │  Container  │ │
│ │   (nginx)   │ │
│ └─────────────┘ │
│ ┌─────────────┐ │
│ │  Container  │ │  ← Дополнительный контейнер
│ │   (nginx)   │ │     для масштабирования
│ └─────────────┘ │
└─────────────────┘
```

**Правило масштабирования:**
```
✅ ДЛЯ масштабирования: создавайте новые Pods
❌ НЕ добавляйте контейнеры в Pod для масштабирования
```

---

</details>

<details>
<summary><b>🌐Общие ресурсы внутри Pod</b></summary>

---

### Сеть
```
# Схема: Общая сеть в Pod
Pod IP: 10.244.1.5
┌─────────────────┐
│      Pod A      │
│ ┌─────────────┐ │   Контейнеры общаются
│ │ Container 1 │ ←──→ через localhost
│ └─────────────┘ │
│ ┌─────────────┐ │
│ │ Container 2 │ │
│ └─────────────┘ │
└─────────────────┘
```

- Каждому Pod'у присваивается **уникальный IP-адрес**
- Контейнеры используют **общее сетевое пространство имен**
- Взаимодействие между контейнерами через `localhost`
- Координация портов при внешнем взаимодействии

### Хранилище
```
# Схема: Общее хранилище в Pod
┌─────────────────────────────────┐
│             Pod A               │
│ ┌─────────────┐ ┌─────────────┐ │
│ │ Container 1 │ │ Container 2 │ │
│ └─────────────┘ └─────────────┘ │
│          Shared Volume          │
│        /shared/data/           │
└─────────────────────────────────┘
```

- Pod определяет набор **общих томов (volumes)**
- Контейнеры обмениваются данными через тома
- Данные сохраняются при перезапуске контейнеров
- **Время жизни томов = времени жизни Pod'а**

---

</details>

<details>
<summary><b>⏳Жизненный цикл Pod'а</b></summary>

---

```
# Схема: Жизненный цикл Pod
Создание → Running → (Перезапуск контейнера) → Running → Удаление
     ↓         ↓               ↓               ↓         ↓
  Pending   Запущен     Контейнер падает   Восстановлен  Terminating
           успешно        и перезапускается
```

Pod создается и запускается на ноде через scheduler. Остается на ноде до тех пор, пока:

- ❌ Не завершится процесс внутри
- ❌ Не будет удален вручную  
- ❌ Не "выселится" из-за нехватки ресурсов
- ❌ Нода не выйдет из строя

> 🔄 **Примечание:** Перезапуск контейнера ≠ перезапуск Pod'а

---

</details>

<details>
<summary><b>⚠️Ограничения Pod'ов</b></summary>

---

```
# Схема: Pod'ы не самовосстанавливаются
Сбой ноды → Все Pod'ы на ноде удаляются
Нехватка ресурсов → Pod'ы удаляются
Ошибка запуска → Pod останавливается

# Решение: Использовать контроллеры
Deployment → Создает новые Pod'ы при сбоях
StatefulSet → Управляет stateful Pod'ами  
DaemonSet → По одному Pod'у на каждой ноде
```

Pod'ы **не являются самовосстанавливающимися** объектами:

- При сбое ноды Pod удаляется
- При нехватке ресурсов Pod удаляется
- При ошибке запуска Pod удаляется

Для управления Pod'ами используются **контроллеры**:

- **Deployment** - для статичных приложений
- **StatefulSet** - для stateful-приложений (БД)
- **DaemonSet** - по одному Pod'у на ноде

---

</details>

<details>
<summary><b>🛠️Создание и управление Pods</b></summary>

---

### Быстрое создание через kubectl
```
# Создать Pod с образом nginx
kubectl run nginx-pod --image=nginx

# Просмотреть созданные Pods
kubectl get pods

# Детальная информация о Pod
kubectl describe pod nginx-pod
```

### Создание через YAML манифест
```
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox
    command: ['sh', '-c', 'echo Hello Kubernetes! && sleep 3600']
```

```
# Применить манифест
kubectl apply -f pod-manifest.yaml
```

---

</details>

---

## Резюме

✅ **Pod** — базовая единица развертывания в Kubernetes

✅ **Итоговые принципы работы с Pods:**
1. Один Pod = один экземпляр приложения
2. Масштабирование = новые Pods, а не контейнеры
3. Мультиконтейнерные = только для связанных процессов
4. Общие ресурсы = сеть + хранилище
5. Эфемерность = нужны контроллеры для надежности

✅ **Ключевые моменты:**
- Pod — базовая единица развертывания в Kubernetes
- Один Pod ≈ один экземпляр приложения
- Масштабирование через создание новых Pods, а не контейнеров
- Мультиконтейнерные Pods только для тесно связанных процессов
- Общие ресурсы: сеть и хранилище внутри Pod'а
- Эфемерность: Pod'ы не самовосстанавливаются
- Управление через контроллеры: Deployment, StatefulSet, DaemonSet

> 💡 **Совет:** В продакшене редко создавайте Pod'ы напрямую. Используйте контроллеры для надежного управления жизненным циклом.

---