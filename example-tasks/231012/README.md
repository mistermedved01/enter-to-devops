# Введение:

Ваш друг Саня, наблюдая за вами, тоже захотел стать девопсом, но он выбрал свой собственный путь - отправился изучать родмапы на сайтах. Спустя месяцы изучения программирования он захотел установить phpmyadmin для управления базой данных на сервере и вспомнил, что изначальный план быть стать девопсом - и вот ваш друг наконец пришел к вам за помощью. Вам не хотелось обесценивать его учебы, поэтому вместе вы решили развить проект Сани и обвешать его девопс-практиками. Так и начался ваш дивный поход в мир развертывания и мониторинга MySQL…

## Документация:

- [Как поднимать виртуальные машины в Vagrant](https://gitlab.com/deusops/lessons/documentation/vagrant)
- [Установка phpmyadmin в ubuntu](https://selectel.ru/blog/tutorials/how-to-install-and-configure-phpmyadmin-on-ubuntu-20-04/)
- [Подборка информации по Prometheus, Grafana и Loki](https://gitlab.com/deusops/lessons/documentation/prometheus-grafana)
- [Подборка информации по Ansible и написанию ролей](https://gitlab.com/deusops/lessons/documentation/ansible)
- [Репликация](https://habr.com/ru/articles/532216/) и [Бэкапы в Mysql](https://dev.mysql.com/doc/refman/8.0/en/backup-and-recovery.html)
- [Подборка информации по Terraform](https://gitlab.com/deusops/documentation/terraform)
- [Хороший туториал-видео пo Terraform](https://youtu.be/SLB_c_ayRMo)

## Чекпоинты по уровню сложности:

### Light:
1. Разверните три виртуальные машины c linux: web01, db01 и mon01. Можно использовать любые способы создания, например в Яндекс Облаке или локально на Vagrant 
2. Установите сервер баз данных MySQL на виртуальную машину "db01" 
3. Установите и настройте Nginx на виртуальную машину "web01" 
4. Установите приложение phpmyadmin на виртуальной машине web01 и настройте его для работы с вашим MySQL 
5. На виртуальной машине "mon01" установите Grafana и Prometheus 
6. Установить на "web01" и "db01" Prometheus-exporter и настроить сбор метрик для мониторинга на "mon01"
7. Установите на "web01" [приложение по инструкции](https://piwigo.org/guides/install/manual) 

### Normal:
1. Разработайте Ansible-роли для установки и настройки nginx и phpmyadmin
2. Разработайте Ansible-роль установки и настройки mysql. Продумайте функционал определения пути директории для файлов БД
3. Напишите Ansible-playbook для развертывания вашего контура с приложением, задачи должны быть вынесены в атомарные роли разработанные ранее, конфигурация контура должна быть сделана через ansible-inventory с переопределением стандартных переменных в group_vars
4. Создайте бэкап-сценарий для MySQL базы данных, разверните сервер бэкапов и учтите сценарий настройки в ansible-роли для MySQL
5. Настройте мониторинг Nginx и MySQL в Prometheus, создайте панели мониторинга в Grafana, отображающие основные метрики (например, запросы в секунду, использование CPU и памяти) Nginx и MySQL
6. Настройте алертинг в Grafana, чтобы получать уведомления в случае проблем с приложением или серверами

### Hard:
1. Написать Ansible-playbook для развертывания системы мониторинга. Вынести в отдельные Ansible-роли для развертывания Grafana, Prometheus и экспортёры
2. Разверните второй экземпляр MySQL в режиме мастер-мастер или мастер- слейв для обеспечения отказоустойчивости и резервного копирования данных. Учтите этот сценарий в ansible-роли
3. Развернуть второй контур используя разработанные механизмы и включить его в мониторинг на сервере mon01. Настройте сбор дополнительных метрик, таких как доли I/О, потребление дискового пространства и дополнительные метрики Nginx
4. Покрыть Ansible-роли тестами в Molecule. Разработать Gitlab CI пайплайн для автоматического тестирования ansible-ролей и внедрить его в репозитории с ролями
5. Разработать Gitlab CI пайплайн для автоматического развертывания системы мониторинга

### Expert:
1. Создать документацию с описанием архитектуры, настроек и процедур обслуживания для вашей инфраструктуры
2. Разместите Приложение у вас в репозитории как рабочий проект, и продумайте флоу доставки приложения на контура. Разработать Gitlab Cl пайплайн для автоматического развертывания окружений с приложением на контурах dev, test и prod
3. Оформить развертывание всей инфраструктуры в Яндекс Облаке через Terraform. Провижн виртуальных машин оставить силами Ansible
